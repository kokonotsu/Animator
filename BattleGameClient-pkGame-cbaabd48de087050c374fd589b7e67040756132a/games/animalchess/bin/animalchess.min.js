var __reflect=this&&this.__reflect||function(e,s,t){e.__class__=s,t?t.push(s):t=[s],e.__types__=e.__types__?t.concat(e.__types__):t},__extends=this&&this.__extends||function(e,s){function t(){this.constructor=e}for(var i in s)s.hasOwnProperty(i)&&(e[i]=s[i]);t.prototype=s.prototype,e.prototype=new t},AnimalChess;!function(e){var s=function(){function s(){var s=this;this.isAttack=!1,this.aicontrol=function(){if(GameAnimalChessView.instance){var e=GameAnimalChessView.instance.chessboardController,t=(GameAnimalChessView.instance.userController,e.chessboardMap);s.selfChessesGrid=[],s.comptitorChessesGrid=[];for(var i in t)t[i].chess&&t[i].chess.type===s.contronType&&t[i].chess.isVisible&&s.selfChessesGrid.push(t[i]),t[i].chess&&t[i].chess.type!==s.contronType&&t[i].chess.isVisible&&s.comptitorChessesGrid.push(t[i]),t[i].scan=!1;s.selfChessesGrid.length<s.comptitorChessesGrid.length?s.isAttack=!1:s.isAttack=!0;for(var a=0,n=s.selfChessesGrid;a<n.length;a++){var r=n[a],o=e.getWalkableGrid(r.position.x,r.position.y);if(o.length>0)for(var h=0,l=o;h<l.length;h++){var p=l[h];if(p.chess&&p.chess.type!==s.contronType&&p.chess.isVisible){if(!s.isAttack&&1===e.gradeCompare(r.chess,p.chess))return e.move(r.position.x,r.position.y,p.position.x,p.position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s);if(s.isAttack&&2!==e.gradeCompare(r.chess,p.chess))return e.move(r.position.x,r.position.y,p.position.x,p.position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}}}for(var c={},m=[],d=0,u=s.selfChessesGrid;d<u.length;d++){var r=u[d],g=e.getWalkableGrid(r.position.x,r.position.y);if(g.length>0)for(var C=0,w=g;C<w.length;C++){var v=w[C];s.currentChess=r;var A=s.seeAround(v);A&&(c[s.dis]={start:r,end:A},m.push(s.dis)),s.restoreGrids()}}m.sort(function(e,s){return e-s});for(var f=0,y=m;f<y.length;f++){var G=y[f],b=c[G].start,A=c[G].end;if(A.position.x>b.position.x){var T=e.getId(b.position.x+1,b.position.y);if(!e.chessboardMap[T].chess)return e.move(b.position.x,b.position.y,b.position.x+1,b.position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}if(A.position.x<b.position.x){var T=e.getId(b.position.x-1,b.position.y);if(!e.chessboardMap[T].chess)return e.move(b.position.x,b.position.y,b.position.x-1,b.position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}if(A.position.y>b.position.y){var T=e.getId(b.position.x,b.position.y+1);if(!e.chessboardMap[T].chess)return e.move(b.position.x,b.position.y,b.position.x,b.position.y+1,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}if(A.position.y<b.position.y){var T=e.getId(b.position.x,b.position.y-1);if(!e.chessboardMap[T].chess)return e.move(b.position.x,b.position.y,b.position.x,b.position.y-1,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}}var M=[];for(var i in t)t[i].chess&&!t[i].chess.isVisible&&M.push(t[i]);if(M.length>0){var V=Math.floor(Math.random()*M.length);return e.displayGrid(M[V].position.x,M[V].position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}for(var _=0,E=s.selfChessesGrid;_<E.length;_++){var r=E[_],g=e.getWalkableGrid(r.position.x,r.position.y),V=Math.floor(Math.random()*g.length),x=g[V];return e.move(r.position.x,r.position.y,x.position.x,x.position.y,!1),void App.TimerManager.doTimer(550,1,s.setUserData,s)}}},this.setUserData=function(){var t=GameAnimalChessView.instance.chessboardController.getChessNumber();(!t.isAllDisplay||0!=t.RED&&0!=t.BLUE)&&(s._round=e.RoundType.competitor,GameAnimalChessView.instance.userController.currentRound=e.RoundType.self,GameAnimalChessView.instance.chessboardController.showSelfChesses())},this.dis=0,this.seeAround=function(e){var t=GameAnimalChessView.instance.chessboardController,i=(GameAnimalChessView.instance.userController,t.getWalkableGrid(e.position.x,e.position.y));if(e.scan=!0,i.length>0)for(var a=0,n=i;a<n.length;a++){var r=n[a];if(r.chess&&s.currentChess.chess&&r.chess.type!==s.contronType&&r.chess.isVisible){if(!s.isAttack&&1===t.gradeCompare(s.currentChess.chess,r.chess))return s.dis++,r;if(s.isAttack&&2!==t.gradeCompare(s.currentChess.chess,r.chess))return s.dis++,r}}for(var o=0,h=i;o<h.length;o++){var r=h[o];if(!r.scan)return s.dis++,s.seeAround(r)}},this.dispose=function(){App.TimerManager.remove(s.setUserData,s)}}return Object.defineProperty(s.prototype,"round",{set:function(s){this._round=s,s===e.RoundType.self&&(App.TimerManager.doTimer(1e3,1,this.aicontrol,this),GameAnimalChessView.instance.chessboardController.hideSelfChesses())},enumerable:!0,configurable:!0}),s.prototype.restoreGrids=function(){var e=GameAnimalChessView.instance.chessboardController.chessboardMap;for(var s in e)e[s].scan=!1},s}();e.AIController=s,__reflect(s.prototype,"AnimalChess.AIController")}(AnimalChess||(AnimalChess={}));var AnimalChess;!function(e){var s=function(){function s(){var s=this;this.animalLength=8,this.sideNum=4,this.onOneHand=null,this.numSound=0,this.checkChess=function(){var t=[],i=[];for(var a in s.chessboardMap)s.chessboardMap[a].chess&&(s.chessboardMap[a].chess.type===e.ChessType.RED?i.push(s.chessboardMap[a].chess.animalGrade):t.push(s.chessboardMap[a].chess.animalGrade));if(i.length>t.length)return void s.chessTypeWin(e.ChessType.RED);if(i.length<t.length)s.chessTypeWin(e.ChessType.BLUE);else{i.sort(function(e,s){return s-e}),t.sort(function(e,s){return s-e});for(var a=0;a<i.length;a++)i[a]>t[a]?s.chessTypeWin(e.ChessType.RED):i[a]<t[a]&&s.chessTypeWin(e.ChessType.BLUE)}},this.winByDisplay=function(){s.win(s._chessboardGrid[s.winId].chess,s._chessboardGrid[s.winId].chess,s._chessboardGrid[s.winId])}}return s.prototype.chessboardInit=function(){for(var s=[{animalGrade:0,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:1,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:2,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:3,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:4,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:5,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:6,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:7,type:e.ChessType.RED,isVisible:!1,position:null},{animalGrade:0,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:1,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:2,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:3,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:4,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:5,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:6,type:e.ChessType.BLUE,isVisible:!1,position:null},{animalGrade:7,type:e.ChessType.BLUE,isVisible:!1,position:null}],i={},a=[],n=0;n<this.sideNum;n++){for(var r=function(e){var r=o.getId(e,n),h=Math.floor(GameAnimalChessView.random()*s.length),l=s[h];l.position={x:e,y:n},i[r]=new t(l.position,l.type,l.animalGrade);var p={id:r,position:l.position,type:l.type,animalGrade:l.animalGrade};a.push(p),s.splice(h,1),i[r].x=157.5*i[r].position.x*GameAnimalChessView.scale,i[r].y=175*i[r].position.y*GameAnimalChessView.scale,i[r].touchEnabled=!0,i[r].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameAnimalChessView.instance.userController.clickHandler(r)},o),GameAnimalChessView.instance.gameLayer.addChild(i[r]),DataCenter.instance.room.selfIsMaster&&i[r].chess.showVisibleBorder()},o=this,h=0;h<this.sideNum;h++)r(h);this._chessboardGrid=i,DataCenter.instance.room.IsAI&&(this.AI=new e.AIController),this.moveAffect=AssetManager.getDBArmature("yidong"),this.moveAffect.x=-300,this.moveAffect.y=-300,GameAnimalChessView.instance.gameLayer.addChild(this.moveAffect)}DataCenter.instance.room.IsAI||App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this)},s.prototype.onGameEvent=function(s){var t=function(e){var s=e.split("|");return s},i=t(s.event);switch(i[0]){case"nextRound":"show"===i[1]&&this.displayGrid(parseInt(i[2]),parseInt(i[3]),!1),"move"===i[1]&&this.move(parseInt(i[2]),parseInt(i[3]),parseInt(i[4]),parseInt(i[5]),!1),GameAnimalChessView.instance.userController.currentRound=e.RoundType.self,this.showSelfChesses(),GameAnimalChessView.instance.userController.canDrawn=!0;break;case"comcontrol":void 0===GameAnimalChessView.instance.userController.controlChess&&(GameAnimalChessView.instance.userController.controlChess=parseInt(i[1]))}},s.prototype.getId=function(e,s){if(0>e||e>this.sideNum)return null;if(0>s||s>=this.sideNum)return null;var t=s*this.sideNum+e;return t},s.prototype.isGridWalkable=function(e,s,t){if(null===s)return!1;var i=this._chessboardGrid[e],a=this._chessboardGrid[s];return a.chess?a&&i.type!==a.chess.type&&a.chess.isVisible?(t&&t.push(a),!0):!1:(t&&t.push(a),!0)},s.prototype.gradeCompare=function(s,t){if(s.animalGrade===e.AnimalGrade.mouse&&t.animalGrade===e.AnimalGrade.elephant||s.animalGrade===e.AnimalGrade.elephant&&t.animalGrade===e.AnimalGrade.mouse)return this.numSound=0,s.animalGrade===e.AnimalGrade.mouse?1:2;var i=s.animalGrade-t.animalGrade;return i>0?(this.numSound=s.animalGrade,1):0>i?(this.numSound=t.animalGrade,2):0===i?(this.numSound=s.animalGrade,3):void 0},s.prototype.sendNextRound=function(s,t){void 0===t&&(t=!1),DataCenter.instance.room.IsAI?t||(this.AI.round=e.RoundType.self):(App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"nextRound|"+s),this.hideSelfChesses()),GameAnimalChessView.instance.userController.canDrawn=!0},s.prototype.sendResult=function(e){App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,e)},s.prototype.getChessNumber=function(){var s=0,t=0,i=!0;for(var a in this.chessboardMap)this.chessboardMap[a].chess&&(0==this.chessboardMap[a].chess.isVisible&&(i=!1),this.chessboardMap[a].chess.type===e.ChessType.RED?t++:s++);return{RED:t,BLUE:s,isAllDisplay:i}},s.prototype.checkOpenChase=function(){var s=this.getChessNumber();s.RED+s.BLUE<=3&&GameAnimalChessView.instance.userController.wasteLimit===e.UserController.normalLimit&&(GameAnimalChessView.instance.userController.openChase(),DataCenter.instance.room.IsAI||App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"openChase"))},s.prototype.chessTypeWin=function(e){GameAnimalChessView.instance.userController.controlChess===e?this.sendResult(3):this.sendResult(1)},s.prototype.getWalkableGrid=function(e,s){var t,i=this.getId(e,s),a=(this._chessboardGrid[i],[]);return e-1>=0&&(t=this.getId(e-1,s),this.isGridWalkable(i,t,a)),e+1<=this.sideNum-1&&(t=this.getId(e+1,s),this.isGridWalkable(i,t,a)),s-1>=0&&(t=this.getId(e,s-1),this.isGridWalkable(i,t,a)),s+1<=this.sideNum-1&&(t=this.getId(e,s+1),this.isGridWalkable(i,t,a)),a},s.prototype.win=function(s,t,i){var a=this,n=GameAnimalChessView.instance.userController,r=AssetManager.getDBArmature("shengliqipao"),o=AssetManager.getBitmap(e.AnimalGrade[s.animalGrade]+"_png");r.replaceSlot("dongwucao",o);var h,l=i.localToGlobal(t.x,t.y,h);r.x=l.x,r.y=l.y,GameAnimalChessView.instance.UILayer.addChild(r),r.play("shengliqibao");var p,c,m;s.type===n.controlChess?(p=n.comImg.x-40*GameAnimalChessView.scale,c=n.comImg.y,m=n.comImg,r.scaleX=-1):(p=n.userImg.x+40*GameAnimalChessView.scale,c=n.userImg.y,m=n.userImg),egret.Tween.get(r).to({x:p,y:c},1e3).call(function(){m.play("shibaitanfei",1);var e=AssetManager.getBitmap("shadow_png");s.type===n.controlChess?e.x=p+m.width/4:e.x=p-m.width/4,e.y=c,GameAnimalChessView.instance.UILayer.addChild(e),egret.Tween.get(m).to({x:App.GameWidth/2,y:100},1e3).call(function(){s.type==n.controlChess?n.userImg.play("win1"):n.comImg.play("win2"),a.chessTypeWin(s.type)})})},s.prototype.move=function(e,s,t,i,a){var n=this;void 0===a&&(a=!0);var r=this.getId(e,s),o=this.getId(t,i),h=this._chessboardGrid[r],l=this._chessboardGrid[o];this.onOneHand.visible=!1;var p=!1,c=(this.getWalkableGrid(e,s),"animal_move_mp3");if(App.SoundManager.playEffect(c),void 0===l.chess){var m=h.getCopyChess();h.clear(!0),m.x=h.x-l.x,m.y=h.y-l.y,l.chessLayer.addChild(m),egret.Tween.get(m).to({x:0,y:0},300).call(function(){l.chess=m,n.checkOpenChase(),a&&!p&&n.sendNextRound("move|"+e+"|"+s+"|"+t+"|"+i)}),GameAnimalChessView.instance.userController.wasteMove.push({start:{x:e,y:s},end:{x:t,y:i}}),GameAnimalChessView.instance.userController.chackWaste()}else{var d=[],u=[];for(var g in this.chessboardMap){var C=this.chessboardMap[g];C.chess&&l.chess&&C.chess.type===l.chess.type&&d.push(C),C.chess&&h.chess&&C.chess.type===h.chess.type&&u.push(C)}var w,v=this.gradeCompare(h.chess,l.chess),A=h.getCopyChess();h.clear(!0),A.x=h.x-l.x,A.y=h.y-l.y,l.chessLayer.addChild(A);var f=!0;for(var g in this.chessboardMap)this.chessboardMap[g].chess&&!this.chessboardMap[g].chess.isVisible&&(f=!1);switch(v){case 1:w=function(e){GameAnimalChessView.instance.userController.onPlayExpress(e),1==d.length&&f&&(n.win(e,l.chess,l),p=!0),l.clear(!0),l.chess=e};break;case 2:w=function(e){GameAnimalChessView.instance.userController.onPlayExpress(l.chess),1==u.length&&f&&(n.win(l.chess,e,l),p=!0),e.destroy()};break;case 3:w=function(e){GameAnimalChessView.instance.userController.onPlayExpress(null),1==d.length&&f?(n.win(e,l.chess,l),p=!0):1==u.length&&f&&(n.win(l.chess,e,l),p=!0),l.clear(!0),p&&1==u.length&&1==d.length||e.destroy()}}A.dbArmature.play("chi",1),egret.Tween.get(A).to({x:0,y:0},500,egret.Ease.bounceOut).call(function(){n.moveAffect.x=l.x+l.chess.dbArmature.width/2,n.moveAffect.y=l.y+l.chess.dbArmature.height/2,n.moveAffect.play("chi",1),w(A);var r="animal_"+n.numSound+"_mp3";App.SoundManager.playEffect(r),n.checkOpenChase(),a&&n.sendNextRound("move|"+e+"|"+s+"|"+t+"|"+i,p)}),GameAnimalChessView.instance.userController.wasteMove=[]}},s.prototype.displayGrid=function(s,t,i){var a=this;void 0===i&&(i=!0);var n=this.getId(s,t),r="animal_displayChess_mp3";App.SoundManager.playEffect(r),this._chessboardGrid[n].tap(function(){void 0===GameAnimalChessView.instance.userController.controlChess&&(GameAnimalChessView.instance.userController.controlChess=a._chessboardGrid[n].chess.type,DataCenter.instance.room.IsAI?a._chessboardGrid[n].chess.type===e.ChessType.BLUE?a.AI.contronType=e.ChessType.RED:a.AI.contronType=e.ChessType.BLUE:a._chessboardGrid[n].chess.type===e.ChessType.BLUE?App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"comcontrol|"+e.ChessType.RED):App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"comcontrol|"+e.ChessType.BLUE)),GameAnimalChessView.instance.userController.wasteMove=[],i&&a.sendNextRound("show|"+s+"|"+t);var r=a.getChessNumber();r.isAllDisplay&&(0==r.RED||0==r.BLUE)&&(a.winId=n,App.TimerManager.doTimer(200,1,a.winByDisplay,a))}),null==this.onOneHand&&(this.onOneHand=AssetManager.getBitmap("Ontheonehand_png"),GameAnimalChessView.instance.gameLayer.addChild(this.onOneHand)),this.onOneHand.visible=!0,this.onOneHand.x=this._chessboardGrid[n].x+100,this.onOneHand.y=this._chessboardGrid[n].y+10},Object.defineProperty(s.prototype,"chessboardMap",{get:function(){return this._chessboardGrid},enumerable:!0,configurable:!0}),s.prototype.showSelfChesses=function(){for(var e in this._chessboardGrid)if(this._chessboardGrid[e].chess){var s=this.getWalkableGrid(this._chessboardGrid[e].position.x,this._chessboardGrid[e].position.y);s.length>0&&this._chessboardGrid[e].chess.showBorder(GameAnimalChessView.instance.userController.controlChess),this._chessboardGrid[e].chess.showVisibleBorder()}},s.prototype.hideSelfChesses=function(){for(var e in this._chessboardGrid)this._chessboardGrid[e].chess&&this._chessboardGrid[e].chess.hiddenBorder()},s.prototype.dispose=function(){App.TimerManager.remove(this.winByDisplay,this),App.MessageCenter.removeAll(this),DataCenter.instance.room.IsAI&&this.AI.dispose()},s}();e.ChessboardController=s,__reflect(s.prototype,"AnimalChess.ChessboardController");var t=function(e){function s(s,t,a){var n=e.call(this)||this;n.tap=function(e){n._chess.tap(e)},n.clear=function(e){n._chess.parent==n.chessLayer&&(n.chessLayer.removeChild(n._chess),e&&n._chess.destroy(),n._chess=void 0)},n.getCopyChess=function(){return new i(n._chess.type,n._chess.animalGrade,!0)},n.chessLayer=new egret.DisplayObjectContainer;var r=AssetManager.getBitmap("spaceGrid_png",!1,!1);return n.addChild(r),r.width*=GameAnimalChessView.scale,r.height*=GameAnimalChessView.scale,n.position=s,n._chess=new i(t,a),n.chessLayer.addChild(n._chess),n.addChild(n.chessLayer),n}return __extends(s,e),Object.defineProperty(s.prototype,"chess",{get:function(){return this._chess},set:function(e){this._chess=e,this.chessLayer.addChild(this._chess),this._chess.x=0,this._chess.y=0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"type",{get:function(){return this._chess?this._chess.type:null},enumerable:!0,configurable:!0}),s}(egret.DisplayObjectContainer);e.ChessGrid=t,__reflect(t.prototype,"AnimalChess.ChessGrid");var i=function(s){function t(t,i,a){void 0===a&&(a=!1);var n=s.call(this)||this;if(n.tap=function(e){if(!n.isVisible){n.isVisible=!0;var s=function(){n.dbArmature.removeDisplayEvent(dragonBones.EventObject.COMPLETE,s,n),n.dbArmature.replaceSlot("Button",n.bitmap),e()};n.dbArmature.addDisplayEvent(dragonBones.EventObject.COMPLETE,s,n),n.dbArmature.play("fanqi",1)}},n.destroy=function(){n.parent&&n.parent.removeChild(n),n.animalGrade=null,n.isVisible=null,n.bitmap=null},n.border=AssetManager.getBitmap("chessLuminous_png",!1,!1),n.border.width*=GameAnimalChessView.scale,n.border.height*=GameAnimalChessView.scale,n.border.x=-15*GameAnimalChessView.scale,n.border.y=-11*GameAnimalChessView.scale,n.border.alpha=0,n.addChild(n.border),n.type=t,n.isVisible=a,n.animalGrade=i,n.dbArmature=AssetManager.getDBArmature("qizi"),n.bitmap=AssetManager.getBitmap(e.AnimalGrade[n.animalGrade]+n.type+"_png",!1,!1),n.bitmap.width*=GameAnimalChessView.scale,n.bitmap.height*=GameAnimalChessView.scale,n.bitmap.anchorOffsetX=n.bitmap.width/2,n.bitmap.anchorOffsetY=n.bitmap.height/2,n.isVisible)n.dbArmature.replaceSlot("Button",n.bitmap);else{var r=AssetManager.getBitmap("space_png",!1,!1);r.width*=GameAnimalChessView.scale,r.height*=GameAnimalChessView.scale,r.anchorOffsetX=r.width/2,r.anchorOffsetY=n.bitmap.height/2,n.dbArmature.replaceSlot("Button",r)}return n.dbArmature.x=n.dbArmature.width/2,n.dbArmature.y=n.dbArmature.height/2,n.addChild(n.dbArmature),n}return __extends(t,s),t.prototype.showBorder=function(e){this.type===e&&(this.border.alpha=1)},t.prototype.showVisibleBorder=function(){this.isVisible||(this.border.alpha=1)},t.prototype.hiddenBorder=function(){this.border.alpha=0},Object.defineProperty(t.prototype,"select",{set:function(e){e?this.dbArmature.scaleX=this.dbArmature.scaleY=1.2:this.dbArmature.scaleX=this.dbArmature.scaleY=1},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);e.Chess=i,__reflect(i.prototype,"AnimalChess.Chess")}(AnimalChess||(AnimalChess={}));var GameAnimalChessView=function(e){function s(){var t=e.call(this)||this;return t.pauseCallback=function(){App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,1),t.next("gameChangeMatch")},t.onGameResult=function(e){DataCenter.instance.room.gameResult=e,console.log(DataCenter.instance.room.id+"号房收到结果为"+DataCenter.instance.user.id+":"+e.winUserId);var s=function(){App.MessageCenter.dispatch(EventMessage.gameCloseGiveUp);var s=2e3;if(e.winUserId==DataCenter.instance.user.id){t.tipController.showChiji(s);var i="animal_win_mp3";App.SoundManager.playEffect(i)}else if(e.winUserId==DataCenter.instance.room.player.id){t.tipController.isGiveUp?s=0:t.tipController.showFailure(s);var i="animal_lose_mp3";App.SoundManager.playEffect(i)}else t.tipController.showDrawn(s);t.chiji.play("winjiazi",0),App.SoundManager.stopBg(),App.TimerManager.doTimer(s,1,function(){DataCenter.instance.room.gameResult=e,t.popup("GameResult"),t.over()},t)};t.popup("GameResult",s)},t.viewInit=function(){t.initBackground(),t.gameLayer.width=604*s.scale,t.gameLayer.height=668*s.scale,t.gameLayer.anchorOffsetX=t.gameLayer.width/2,t.gameLayer.anchorOffsetY=t.gameLayer.height/2,t.gameLayer.x=App.GameWidth/2,t.gameLayer.y=t.backgroundMain.y+t.backgroundMain.height/2,t.addChild(t.gameLayer),t.UILayer.height=App.GameHeight,t.UILayer.anchorOffsetY=t.UILayer.height/2,t.UILayer.y=App.GameHeight/2,t.addChild(t.UILayer),App.IsXiaoMi||App.IsWanba||(t.returnToLastButton=AssetManager.getBitmap("goBack_png",!1,!1),t.returnToLastButton.y=19,t.UILayer.addChild(t.returnToLastButton),t.returnToLastButton.touchEnabled=!0,t.returnToLastButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.popup("GameSureLeave")},t)),t.chiji=AssetManager.getDBArmature("chiji"),t.chiji.scaleX=t.chiji.scaleY=s.scale,t.chiji.x=App.GameWidth/2,t.chiji.y=150*s.scale,t.UILayer.addChild(t.chiji),t.chiji.play("dong",0);var e=AssetManager.getBitmap("animalRank_png");for(e.width*=s.scale,e.height*=s.scale;e.width>App.GameWidth;)e.width*=.95,e.height*=.95;e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=App.GameWidth/2,e.y=947*s.scale,t.UILayer.addChild(e);var i=AssetManager.getBitmap("animal_blackMask_png");i.width=App.GameWidth,i.height=(App.GameHeight-t.backgroundMain.height)/2,i.anchorOffsetY=i.height,i.anchorOffsetX=i.width/2,i.x=App.GameWidth/2,i.y=0,t.addChild(i);var a=AssetManager.getBitmap("animal_blackMask_png");a.width=App.GameWidth,a.height=(App.GameHeight-t.backgroundMain.height)/2,a.anchorOffsetY=a.height,a.anchorOffsetX=a.width/2,a.x=App.GameWidth/2,a.y=App.GameHeight-(App.GameHeight-t.backgroundMain.height)/2,t.addChild(a)},t.initBackground=function(){var e=AssetManager.getBitmap("animalTop_png",!1,!1);e.width=App.GameWidth,e.anchorOffsetX=e.width/2,e.x=App.GameWidth/2,t.addChild(e);var i=AssetManager.getBitmap("animalTopLeft_png",!1,!1);i.x=0,t.addChild(i);var a=AssetManager.getBitmap("animalTopRight_png",!1,!1);a.x=App.GameWidth-a.width,t.addChild(a),t.backgroundMain=AssetManager.getBitmap("animalMain_png",!1,!1),App.GameHeight<t.backgroundMain.height?(s.scale=App.GameHeight/t.backgroundMain.height,t.backgroundMain.height=App.GameHeight):s.scale=1,t.backgroundMain.width=App.GameWidth*s.scale,t.backgroundMain.anchorOffsetX=t.backgroundMain.width/2,t.backgroundMain.x=App.GameWidth/2;var n=AssetManager.getBitmap("animalLeft_png",!1,!1);n.anchorOffsetX=n.width,n.x=(App.GameWidth-t.backgroundMain.width)/2,n.height=App.GameHeight,t.addChild(n);var r=AssetManager.getBitmap("animalRight_png",!1,!1);r.x=App.GameWidth-(App.GameWidth-t.backgroundMain.width)/2,r.height=App.GameHeight,t.addChild(r),t.addChild(t.backgroundMain);var o=AssetManager.getBitmap("animalBoard_png");o.width*=s.scale,o.height*=s.scale,o.anchorOffsetX=o.width,o.anchorOffsetY=o.height,o.x=App.GameWidth-10,o.y=150*s.scale,t.addChild(o)},t.userController=new AnimalChess.UserController,t.chessboardController=new AnimalChess.ChessboardController,t.tipController=new AnimalChess.TipController,t.gameLayer=new egret.DisplayObjectContainer,t.UILayer=new egret.DisplayObjectContainer,s.instance=t,t}return __extends(s,e),s.prototype.init=function(){e.prototype.init.call(this),s.random=new Math.seedrandom(DataCenter.instance.room.id.toString()),this.viewInit(),this.adapt(),this.tipController.width=App.GameWidth,this.tipController.height=App.GameHeight,this.tipController.init(),this.chessboardController.chessboardInit(),this.userController.init(),this.addChild(this.tipController),App.SoundManager.stopBg();var t="animal_bg_mp3";App.SoundManager.playBg(t),App.MessageCenter.addListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),App.MessageCenter.addListener(EventMessage.GameSendExpress,this.addQiPaoCartoon,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.addListener(EventMessage.pauseMessage,this.pauseCallback,this)},s.prototype.onGameEvent=function(e){var s=function(e){var s=e.split("|");return s},t=s(e.event);switch(t[0]){case"sendExpress":this.addQiPaoCartoon(t[1],2)}},s.prototype.addQiPaoCartoon=function(e,s){void 0===s&&(s=1);var t=new QIPaoCartoon;if(t.y=App.RandomUtils.limitInteger(120,130),this.addChild(t),2==s)t.x=App.RandomUtils.limitInteger(App.GameWidth-105,App.GameWidth-85),t.setSouce(e,!0);else if(t.setSouce(e),t.x=App.RandomUtils.limitInteger(85,105),DataCenter.instance.room.IsAI){var i=App.RandomUtils.limitInteger(1,5);i%2!=0&&App.TimerManager.doTimer(1e3*i,1,this.AddAIexpress,this)}else{var a="sendExpress|"+e;App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,a)}t.onPlay()},s.prototype.AddAIexpress=function(){var e=["1_1","1_2","1_3","1_4","1_5","1_6","2_1","2_2","2_3","2_4","3_1","3_2","3_3","3_4"],s=App.RandomUtils.limitInteger(0,13),t="express"+e[s]+"_png";this.addQiPaoCartoon(t,2)},s.prototype.over=function(){this.userController.dispose(),this.chessboardController.dispose(),App.MessageCenter.dispatch(EventMessage.gameCloseExpress),s.instance=null},s.prototype.adapt=function(){App.GameHeight>this.backgroundMain.height&&(this.y=(App.GameHeight-this.backgroundMain.height)/2)},s.prototype.dispose=function(){e.prototype.dispose.call(this),this.chessboardController.dispose(),this.userController.dispose(),this.tipController.dispose(),App.TimerManager.removeAll(this),App.MessageCenter.removeListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),App.MessageCenter.removeListener(EventMessage.GameSendExpress,this.addQiPaoCartoon,this),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.removeListener(EventMessage.pauseMessage,this.pauseCallback,this)},s}(State);__reflect(GameAnimalChessView.prototype,"GameAnimalChessView");var GameReceiveDrawnView=function(e){function s(){var s=e.call(this,GameAnimalChessReceiveDrawn)||this;return s.showDrawnGroup=function(){s.hide(),s.visible=!0,s.DrawnGroup.visible=!0},s.showWaitDrawnAnswer=function(){s.hide(),s.visible=!0,s.waitDrawnAnswer.visible=!0},s.showDrawnRefuseAnswer=function(){s.hide(),s.visible=!0,s.drawnRefuseAnswer.visible=!0},s.showchiji=function(e){s.hide(),s.visible=!0,s.chijiLogo.visible=!0,s.chijiLogo.scaleX=s.chijiLogo.scaleY=1.2,egret.Tween.get(s.chijiLogo).to({scaleX:1,scaleY:1},e/4,egret.Ease.bounceOut).wait(e/4*3)},s.showDrawn=function(e){s.hide(),s.visible=!0,s.drawnLogo.visible=!0,s.drawnLogo.scaleX=s.drawnLogo.scaleY=1.2,egret.Tween.get(s.drawnLogo).to({scaleX:1,scaleY:1},e/4,egret.Ease.bounceOut).wait(e/4*3)},s.showFailure=function(e){s.hide(),s.visible=!0,s.failureLogo.visible=!0,s.failureLogo.scaleX=s.failureLogo.scaleY=1.2,egret.Tween.get(s.failureLogo).to({scaleX:1,scaleY:1},e/4,egret.Ease.bounceOut).wait(e/4*3)},s.hide=function(){s.failureLogo.visible=s.drawnLogo.visible=s.chijiLogo.visible=s.drawnRefuseAnswer.visible=s.DrawnGroup.visible=s.waitDrawnAnswer.visible=!1,s.visible=!1},s}return __extends(s,e),s}(EuiComponent);__reflect(GameReceiveDrawnView.prototype,"GameReceiveDrawnView");var AnimalChess;!function(e){var s=function(e){function s(){var s=e.call(this)||this;return s.refuseListener=function(){s.receiveDrawnView.hide(),App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"refuseDrawn"),App.TimerManager.remove(s.drawnTime,s)},s.agreeListener=function(){s.receiveDrawnView.hide(),App.TimerManager.remove(s.drawnTime,s),App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"acceptDrawn"),GameAnimalChessView.instance.chessboardController&&GameAnimalChessView.instance.chessboardController.sendResult(2),s.receiveDrawnView.showDrawn(2e3)},s.isGiveUp=!1,s.drawnTime=function(){App.Language==LanguageType.Ch?s.receiveDrawnView.btn_refuse.label="拒绝("+s._drawntime+"s)":s.receiveDrawnView.btn_refuse.label="refuse("+s._drawntime+"s)",s._drawntime--,s._drawntime<0&&(App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"refuseDrawn"),s.receiveDrawnView.visible=!1,App.TimerManager.remove(s.drawnTime,s),s._drawntime=5)},s}return __extends(s,e),s.prototype.init=function(){this.competitorTip=AssetManager.getBitmap("competitorTip_png"),this.competitorTip.x=App.GameWidth/2,this.competitorTip.y=App.GameHeight/2-GameAnimalChessView.instance.y,this.competitorTip.alpha=0,this.addChild(this.competitorTip),this.selfTip=AssetManager.getBitmap("selfTip_png"),this.selfTip.x=App.GameWidth/2,this.selfTip.y=App.GameHeight/2-GameAnimalChessView.instance.y,this.selfTip.alpha=0,this.addChild(this.selfTip),this.giveUpTip=AssetManager.getBitmap("giveUpTitle_png"),this.giveUpTip.x=App.GameWidth/2,this.giveUpTip.y=App.GameHeight/2-150-GameAnimalChessView.instance.y,this.addChild(this.giveUpTip),this.giveUpTip.alpha=0,this.receiveGiveUpTip=AssetManager.getBitmap("receiveGiveUpMessage_png"),this.receiveGiveUpTip.x=App.GameWidth/2,this.receiveGiveUpTip.y=App.GameHeight/2-150-GameAnimalChessView.instance.y,this.addChild(this.receiveGiveUpTip),this.receiveGiveUpTip.alpha=0,App.MessageCenter.addListener(EventMessage.GameGiveUp,this.giveUp,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),this.receiveDrawnView=new GameReceiveDrawnView,this.receiveDrawnView.hide(),this.addChild(this.receiveDrawnView),this.receiveDrawnView.btn_refuse.touchEnabled=!0,this.receiveDrawnView.btn_refuse.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refuseListener,this),this.receiveDrawnView.btn_agree.touchEnabled=!0,this.receiveDrawnView.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.agreeListener,this)},s.prototype.giveUp=function(){var e=this;this.isGiveUp=!0,DataCenter.instance.room.IsAI||App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"giveUp"),this.giveUpTip.alpha=1,App.TimerManager.doTimer(1e3,1,function(){e.giveUpTip.alpha=0,GameAnimalChessView.instance.chessboardController&&GameAnimalChessView.instance.chessboardController.sendResult(1)},this)},s.prototype.showWaitDrawn=function(){var e=this;if(this.receiveDrawnView.showWaitDrawnAnswer(),DataCenter.instance.room.IsAI){var s=App.RandomUtils.limitInteger(0,2);App.TimerManager.doTimer(1e3*s,1,function(){e.receiveDrawnView.showDrawnRefuseAnswer(),App.TimerManager.doTimer(300,1,e.receiveDrawnView.hide,e)},this)}},s.prototype.onGameEvent=function(e){var s=this,t=function(e){var s=e.split("|");return s},i=t(e.event);switch(i[0]){case"giveUp":this.receiveGiveUpTip.alpha=1,App.TimerManager.doTimer(1e3,1,function(){s.receiveGiveUpTip.alpha=0,GameAnimalChessView.instance.chessboardController&&GameAnimalChessView.instance.chessboardController.sendResult(3)},this);break;case"drawnRequest":this.receiveDrawnView.showDrawnGroup(),this._drawntime=5,this.drawnTime(),App.TimerManager.doTimer(1e3,0,this.drawnTime,this);break;case"refuseDrawn":this.receiveDrawnView.showDrawnRefuseAnswer(),App.TimerManager.doTimer(300,1,this.receiveDrawnView.hide,this);break;case"acceptDrawn":this.receiveDrawnView.hide(),GameAnimalChessView.instance.chessboardController&&GameAnimalChessView.instance.chessboardController.sendResult(2),this.receiveDrawnView.showDrawn(2e3)}},s.prototype.wasteTipShow=function(e){var s=this,t=AssetManager.getBitmap("waste"+e+"_png");t.x=App.GameWidth/2,t.y=-100,this.addChild(t),egret.Tween.get(t).to({y:100},500).call(function(){App.TimerManager.doTimer(1e3,1,function(){t.parent&&s.removeChild(t)},s)})},s.prototype.chaseShow=function(){var e=this,s=AssetManager.getBitmap("chaseTip_png");s.x=App.GameWidth/2,s.y=-100,this.addChild(s),egret.Tween.get(s).to({y:100},500).call(function(){App.TimerManager.doTimer(1e3,1,function(){s.parent&&e.removeChild(s)},e)})},s.prototype.showComRoundTip=function(){egret.Tween.get(this.competitorTip).to({alpha:1},300).wait(400).to({alpha:0},300)},s.prototype.setCompetitorTip=function(e){this.competitorTip.texture=AssetManager.getBitmap("competitorTip"+e+"_png").texture},s.prototype.showSelfRoundTip=function(){egret.Tween.get(this.selfTip).to({alpha:1},300).wait(400).to({alpha:0},300)},s.prototype.setSelfTip=function(e){this.selfTip.texture=AssetManager.getBitmap("selfTip"+e+"_png").texture},s.prototype.showChiji=function(e){this.receiveDrawnView.showchiji(e)},s.prototype.showFailure=function(e){this.receiveDrawnView.showFailure(e)},s.prototype.showDrawn=function(e){this.receiveDrawnView.showDrawn(e)},s.prototype.dispose=function(){App.TimerManager.removeAll(this),App.MessageCenter.removeListener(EventMessage.GameGiveUp,this.giveUp,this),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),this.receiveDrawnView.btn_refuse.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.refuseListener,this),this.receiveDrawnView.btn_agree.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.agreeListener,this)
},s}(egret.DisplayObjectContainer);e.TipController=s,__reflect(s.prototype,"AnimalChess.TipController")}(AnimalChess||(AnimalChess={}));var AnimalChess;!function(e){var s;!function(e){e[e.RED=0]="RED",e[e.BLUE=1]="BLUE"}(s=e.ChessType||(e.ChessType={}));var t;!function(e){e[e.self=0]="self",e[e.competitor=1]="competitor"}(t=e.RoundType||(e.RoundType={}));var i;!function(e){e[e.elephant=7]="elephant",e[e.lion=6]="lion",e[e.tiger=5]="tiger",e[e.leopard=4]="leopard",e[e.wolf=3]="wolf",e[e.dog=2]="dog",e[e.cat=1]="cat",e[e.mouse=0]="mouse"}(i=e.AnimalGrade||(e.AnimalGrade={}))}(AnimalChess||(AnimalChess={}));var AnimalChess;!function(e){var s=function(){function e(){}return e.nameLength=6,e}();__reflect(s.prototype,"UserConfig");var t=function(){function t(){var e=this;this.haveSet=!1,this.time=60,this.startTime=function(s){void 0===s&&(s=!0),e.isSelf=s,e.time=60,App.TimerManager.doTimer(1e3,0,e.spliceTime,e)},this.spliceTime=function(){e.time--,e.time<10?e.timeView.text="0"+e.time+"s":e.timeView.text=e.time+"s",e.time<=0&&(e.isSelf?GameAnimalChessView.instance.chessboardController.sendResult(1):DataCenter.instance.room.IsAI&&GameAnimalChessView.instance.chessboardController.sendResult(3),e.removeTime())},this.removeTime=function(){App.TimerManager.remove(e.spliceTime,e)},this.userImgTap=function(){GameAnimalChessView.instance.popup("GameCenterMyHomePage",{lastViewName:"IS_GAMEING",currPlayerData:DataCenter.instance.user})},this.comImgTap=function(){GameAnimalChessView.instance.popup("GameCenterMyHomePage",{lastViewName:"IS_GAMEING",currPlayerData:DataCenter.instance.room.player})},this.canDrawn=!0,this.giveUpListener=function(){GameAnimalChessView.instance.popup("GameGiveUp")},this.drawnListener=function(){e.canDrawn&&(DataCenter.instance.room.IsAI||App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"drawnRequest"),GameAnimalChessView.instance.tipController.showWaitDrawn(),e.canDrawn=!1)},this.sideNum=4,this.chackWaste=function(){if(e.isOpenChase)if(e.firstOpenChase)switch(e.wasteLimit-e.wasteMove.length){case 0:GameAnimalChessView.instance.chessboardController.checkChess();break;case 6:case 4:case 2:GameAnimalChessView.instance.tipController.wasteTipShow((e.wasteLimit-e.wasteMove.length)/2);break;default:return}else switch(e.wasteLimit-e.wasteMove.length){case 0:GameAnimalChessView.instance.chessboardController.checkChess();break;case 5:case 3:case 1:GameAnimalChessView.instance.tipController.wasteTipShow((e.wasteLimit-e.wasteMove.length+1)/2);break;default:return}},this.openChase=function(s){void 0===s&&(s=!0),e.wasteLimit=t.chaseLimit,GameAnimalChessView.instance.tipController.chaseShow(),e.firstOpenChase=s,e.isOpenChase=!0},this.dispose=function(){e.removeTime(),e.userNameBg=null,e.comNameBg=null,e.time=60,App.TimerManager.remove(e.spliceTime,e),e.userImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.userImgTap,e),e.comImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.comImgTap,e),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,e.onGameEvent,e),e.helloButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.sayHello,e),e.giveUpButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.giveUpListener,e),e.drawnButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.drawnListener,e)},this.isWalk=!1,this.walkables=[],this.startGrid=null,this.wasteMove=[],this.wasteLimit=t.normalLimit}return Object.defineProperty(t.prototype,"controlChess",{get:function(){return this._controlChess},set:function(s){this._controlChess=s,s===e.ChessType.RED?(GameAnimalChessView.instance.tipController.setCompetitorTip(e.ChessType.BLUE),GameAnimalChessView.instance.tipController.setSelfTip(e.ChessType.RED)):(GameAnimalChessView.instance.tipController.setCompetitorTip(e.ChessType.RED),GameAnimalChessView.instance.tipController.setSelfTip(e.ChessType.BLUE)),this._currentRound===e.RoundType.self?this.round.texture=AssetManager.getBitmap("selfRound"+s+"_png").texture:this.round.texture=AssetManager.getBitmap("competitorRound"+s+"_png").texture,0==this.haveSet&&(s===e.ChessType.RED?(this.comNameBg.texture=AssetManager.getBitmap("name_blue_png").texture,this.userNameBg.texture=AssetManager.getBitmap("name_red_png").texture,this.haveSet=!0):s===e.ChessType.BLUE&&(this.comNameBg.texture=AssetManager.getBitmap("name_red_png").texture,this.userNameBg.texture=AssetManager.getBitmap("name_blue_png").texture,this.haveSet=!0))},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.initUserView(),this.initCompetitorView(),this.initGiveUpView(),this.helloButton=AssetManager.getBitmap("helloButton_png"),this.helloButton.width*=GameAnimalChessView.scale,this.helloButton.height*=GameAnimalChessView.scale,this.helloButton.anchorOffsetY=this.helloButton.height/2,this.helloButton.anchorOffsetX=this.helloButton.width,this.helloButton.x=App.GameWidth-((App.GameWidth-GameAnimalChessView.instance.backgroundMain.width)/2+17),this.helloButton.y=1048*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(this.helloButton),this.helloButton.touchEnabled=!0,this.helloButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sayHello,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this)},t.prototype.onPlayExpress=function(e){if(!e)return this.comImg.play("beichi",1),void this.userImg.play("beichi",1);var s=GameAnimalChessView.instance.userController;e.type==s.controlChess?(this.userImg.play("chi",1),this.comImg.play("beichi",1)):(this.comImg.play("chi",1),this.userImg.play("beichi",1))},t.prototype.onGameEvent=function(e){switch(e.event){case"openChase":this.openChase(!1)}},t.prototype.initUserView=function(){var e=DataCenter.instance.user;this.userNameBg=AssetManager.getBitmap("animalNameBg_png"),this.userNameBg.scaleX=-1,this.userNameBg.anchorOffsetX=this.userNameBg.width,this.userNameBg.y=184*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(this.userNameBg);var t=new egret.TextField;t.fontFamily="Arial",t.text=e.name,t.size=28,t.text.length>s.nameLength&&(t.size*=s.nameLength/t.text.length),t.anchorOffsetX=t.measuredWidth,t.x=177,t.anchorOffsetY=t.measuredHeight/2,t.y=184*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(t);var i=GameCenterGetSexIcon.getSexIconSource(e.sex),a=AssetManager.getBitmap(i);a.y=184*GameAnimalChessView.scale,a.x=196,GameAnimalChessView.instance.UILayer.addChild(a),this.userImg=new RoleAvatar(e.curAvatarType,e.imgUrl,"dbxiaoren00_game6").armature,this.userImg.scaleX=this.userImg.scaleY=1,this.userImg.y=145*GameAnimalChessView.scale,this.userImg.x=151,GameAnimalChessView.instance.UILayer.addChild(this.userImg),this.userImg.play("jing"),this.userImg.touchEnabled=!0,this.userImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.userImgTap,this)},t.prototype.initCompetitorView=function(){var e=DataCenter.instance.room.player;this.comNameBg=AssetManager.getBitmap("animalNameBg_png"),this.comNameBg.anchorOffsetX=this.comNameBg.width,this.comNameBg.x=App.GameWidth,this.comNameBg.y=184*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(this.comNameBg);var t=new egret.TextField;t.fontFamily="Arial",t.text=DataCenter.instance.room.player.name,t.size=28,t.text.length>s.nameLength&&(t.size*=s.nameLength/t.text.length),t.anchorOffsetX=0,t.x=465,t.anchorOffsetY=t.measuredHeight/2,t.y=184*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(t);var i=GameCenterGetSexIcon.getSexIconSource(e.sex),a=AssetManager.getBitmap(i);a.y=184*GameAnimalChessView.scale,a.x=443,GameAnimalChessView.instance.UILayer.addChild(a),this.comImg=new RoleAvatar(e.curAvatarType,e.imgUrl,"dbxiaoren00_game6").armature,this.comImg.scaleX=this.comImg.scaleY=1,this.comImg.y=145*GameAnimalChessView.scale,this.comImg.x=476,GameAnimalChessView.instance.UILayer.addChild(this.comImg),this.comImg.play("jing"),this.comImg.touchEnabled=!0,this.comImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.comImgTap,this)},t.prototype.initGiveUpView=function(){var s=new egret.DisplayObjectContainer,t=AssetManager.getBitmap("giveUp_png",!1,!1);t.width*=GameAnimalChessView.scale,t.height*=GameAnimalChessView.scale,s.addChild(t),this.timeView=new egret.TextField,this.timeView.text=this.time+"s",this.timeView.anchorOffsetX=this.timeView.measuredWidth/2,this.timeView.anchorOffsetY=this.timeView.measuredHeight/2,this.timeView.size=32*GameAnimalChessView.scale,this.timeView.fontFamily="Arial",this.timeView.x=54*GameAnimalChessView.scale,this.timeView.y=36*GameAnimalChessView.scale,s.addChild(this.timeView),DataCenter.instance.room.selfIsMaster?(this.round=AssetManager.getBitmap("selfRound_png"),this.currentRound=e.RoundType.self):(this.round=AssetManager.getBitmap("competitorRound_png"),this.currentRound=e.RoundType.competitor),this.round.width*=GameAnimalChessView.scale,this.round.height*=GameAnimalChessView.scale,this.round.anchorOffsetX=this.round.width/2,this.round.anchorOffsetY=this.round.height/2,this.round.x=170*GameAnimalChessView.scale,this.round.y=24*GameAnimalChessView.scale,s.addChild(this.round),this.giveUpButton=AssetManager.getBitmap("giveUpButton_png"),this.giveUpButton.width*=GameAnimalChessView.scale,this.giveUpButton.height*=GameAnimalChessView.scale,this.giveUpButton.anchorOffsetX=this.giveUpButton.width/2,this.giveUpButton.anchorOffsetY=this.giveUpButton.height/2,this.giveUpButton.x=310*GameAnimalChessView.scale,this.giveUpButton.y=40*GameAnimalChessView.scale,s.addChild(this.giveUpButton),this.giveUpButton.touchEnabled=!0,this.giveUpButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.giveUpListener,this),this.drawnButton=AssetManager.getBitmap("drawnButton_png"),this.drawnButton.width*=GameAnimalChessView.scale,this.drawnButton.height*=GameAnimalChessView.scale,this.drawnButton.anchorOffsetX=this.drawnButton.width/2,this.drawnButton.anchorOffsetY=this.drawnButton.height/2,this.drawnButton.x=405*GameAnimalChessView.scale,this.drawnButton.y=40*GameAnimalChessView.scale,s.addChild(this.drawnButton),this.drawnButton.touchEnabled=!0,this.drawnButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.drawnListener,this),s.anchorOffsetY=s.height/2,s.y=1048*GameAnimalChessView.scale,GameAnimalChessView.instance.UILayer.addChild(s)},Object.defineProperty(t.prototype,"currentRound",{get:function(){return this._currentRound},set:function(s){this._currentRound=s;var t;t=void 0===this.controlChess?"":this.controlChess.toString(),this.time=60,this.timeView.text="60s",this._currentRound===e.RoundType.self?(this.round.texture=AssetManager.getBitmap("selfRound"+t+"_png").texture,this.startTime(),GameAnimalChessView.instance.tipController.showSelfRoundTip()):(this.round.texture=AssetManager.getBitmap("competitorRound"+t+"_png").texture,GameAnimalChessView.instance.tipController.showComRoundTip(),this.removeTime(),this.startTime(!1))},enumerable:!0,configurable:!0}),t.prototype.clickHandler=function(s){if(this.currentRound===e.RoundType.competitor)return void GameAnimalChessView.instance.tipController.showComRoundTip();var t=GameAnimalChessView.instance.chessboardController,i=t.chessboardMap[s];if(1==this.isWalk&&this.walkables.length>0){for(var a=0;a<this.walkables.length;a++)if(i.position.x===this.walkables[a].position.x&&i.position.y===this.walkables[a].position.y)return this.currentRound=e.RoundType.competitor,this.startGrid.chess.select=!1,t.move(this.startGrid.position.x,this.startGrid.position.y,i.position.x,i.position.y),this.isWalk=!1,this.walkables=[],void(this.startGrid=null);this.isWalk=!1,this.startGrid.chess.select=!1,this.walkables=[],this.startGrid=null}if(i.chess)if(i.chess.isVisible===!1)this.currentRound=e.RoundType.competitor,t.displayGrid(i.position.x,i.position.y),this.isWalk&&(this.isWalk=!1,this.walkables=[],this.startGrid.chess.select=!1,this.startGrid=null);else if(this.isWalk===!1&&0===this.walkables.length&&this.controlChess===i.chess.type)return this.startGrid&&(this.startGrid.chess.select=!1),this.walkables=t.getWalkableGrid(i.position.x,i.position.y),void(this.walkables.length>0&&(this.isWalk=!0,this.startGrid=i,this.startGrid.chess.select=!0))},t.prototype.sayHello=function(){App.GameExpressType=1,GameAnimalChessView.instance.popup("GameExpress")},t.normalLimit=40,t.chaseLimit=20,t}();e.UserController=t,__reflect(t.prototype,"AnimalChess.UserController")}(AnimalChess||(AnimalChess={}));