var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);o.prototype=e.prototype,t.prototype=new o},GameGreedyPersonView=function(t){function e(){var e=t.call(this,GameGreedyPersonSkin)||this;return e.num_time_ChaoFeng=3550,e.numFoodSelfeat=0,e.numFoodEnumyeat=0,e.isGameOver=!1,e.numtime=60,e.isBossXing=!1,e.Caught_Self=!1,e.Caught_Enumy=!1,e.Arr_food=[],e.Arr_food_Shift=[],e.onSelfLocation=1,e.onEnumyLocation=2,e.num_BossChecktime=0,e.numChaoFengFrist=!0,e.ImageYing=null,e.numAiAttack=0,e.iswhoChaoFeng=!1,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),App.SoundManager.stopBg(),App.SoundManager.playBg("bg_musicGreedy_mp3");var o=App.GameWidth/e.GAME_WIDTH,n=App.GameHeight/e.GAME_HEIGHT,s=Math.min(o,n);this.containerGroup.scaleX=this.containerGroup.scaleY=s,this.containerGroup.x=.5*(App.GameWidth-e.GAME_WIDTH*s),this.containerGroup.y=.5*(App.GameHeight-e.GAME_HEIGHT*s);var i=DataCenter.instance.user,a=new RoleHeadImage(i.imgUrl);a.scaleX=a.scaleY=.82,this.playerAvatarGroup1.addChild(a);var h=DataCenter.instance.room.player,r=new RoleHeadImage(h.imgUrl);if(r.scaleX=r.scaleY=.82,this.playerAvatarGroup2.addChild(r),this.addAllDb(),DataCenter.instance.room.IsAI||App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.addListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),DataCenter.instance.room.selfIsMaster||DataCenter.instance.room.IsAI)if(this.onInitFood(),DataCenter.instance.room.IsAI)this.onReadyGo();else{if(!DataCenter.instance.room.IsAI){for(var p="food|",m=0;m<this.Arr_food.length;++m)p+=this.Arr_food[m]+"|";for(var m=0;m<this.Arr_food_Shift.length;++m)p+=m<this.Arr_food_Shift.length-1?this.Arr_food_Shift[m]+"|":this.Arr_food_Shift[m];App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,p)}var p="startGame";App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,p,1)}else this.onSelfLocation=2,this.onEnumyLocation=1,this.gp_you.right=63},e.prototype.onGameResult=function(t){DataCenter.instance.room.gameResult=t,this.popup("GameResult")},e.prototype.gameOver=function(t){App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,t)},e.prototype.onGameEvent=function(t){var e=function(t){var e=t.split("|");return e},o=e(t.event);switch(o[0]){case"food":for(var n=1;15>n;++n){var s=Number(o[n]);this.Arr_food.push(s)}for(var n=15;29>n;++n){var s=Number(o[n]);this.Arr_food_Shift.push(s)}this.setFood(),console.log("布置食物",this.Arr_food,this.Arr_food_Shift);break;case"startGame":this.onReadyGo();break;case"Left_1":1==this.onSelfLocation?this.onlefteat():this.onEnumylefteat();break;case"Left_2":2==this.onSelfLocation?this.onlefteat():this.onEnumylefteat();break;case"Right_1":1==this.onSelfLocation?this.onRighteat():this.onEnumyRighteat();break;case"Right_2":2==this.onSelfLocation?this.onRighteat():this.onEnumyRighteat();break;case"noWake":this.onBossWillComming(10);break;case"iswake":this.onBossWillComming(0);break;case"CatchNO":0==this.num_BossChecktime&&(this.onNoCatchany(),1==this.onSelfLocation&&(this.num_BossChecktime=1,App.TimerManager.doTimer(500,1,this.onBossCheckAgain,this)));break;case"CatchNOAgain":this.onReleaseDouble();break;case"CatchDouble":this.onCatchDouble(),this.onChangeButton(3),App.TimerManager.doTimer(750,1,this.onReleaseDouble,this);break;case"CatchPlayer1":1==this.onSelfLocation?this.onChangeButton(3):this.onChangeButton(1),this.onCatchOne(),App.TimerManager.doTimer(this.num_time_ChaoFeng,1,this.onReleaseDouble,this);break;case"CatchPlayer2":1==this.onSelfLocation?this.onChangeButton(1):this.onChangeButton(3),this.onCatchTwo(),App.TimerManager.doTimer(this.num_time_ChaoFeng,1,this.onReleaseDouble,this);break;case"ChaoFeng1":1==this.onSelfLocation?this.onAddFoodToSelf():this.onAddFoodToEnumy();break;case"ChaoFeng2":2==this.onSelfLocation?this.onAddFoodToSelf():this.onAddFoodToEnumy()}},e.prototype.onReadyGo=function(){var t=this;this.img_start1.visible=!0,egret.Tween.get(this.img_start2).wait(700).call(function(){t.img_start1.visible=!1}).to({scaleX:1,scaleY:1},500).wait(500).call(function(){t.img_start2.visible=!1,egret.Tween.removeTweens(t.img_start2),App.TimerManager.doTimer(1e3,0,t.onTimerUpdate,t),DataCenter.instance.room.IsAI?(App.TimerManager.doTimer(150,0,t.onAiAttack,t),t.chaofengBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onAddFoodToEnumy,t),t.btn_lefteat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onlefteat,t),t.btn_righteat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onRighteat,t)):(t.chaofengBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onNoticeChaoFeng,t),t.btn_lefteat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onNoticelefteat,t),t.btn_righteat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onNoticeRighteat,t))})},e.prototype.onNoticelefteat=function(){if(!this.isGameOver){var t="Left_"+this.onSelfLocation;App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,t,1)}},e.prototype.onNoticeRighteat=function(){if(!this.isGameOver){var t="Right_"+this.onSelfLocation;App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,t,1)}},e.prototype.onTimerUpdate=function(){if(this.isGameOver)return void App.TimerManager.remove(this.onTimerUpdate,this);if(this.numtime--,this.numtime<10?this.lb_time1.text="0"+this.numtime:this.lb_time1.text=""+this.numtime,this.numtime%7==0)if(DataCenter.instance.room.IsAI){var t=App.RandomUtils.limitInteger(1,10);this.onBossWillComming(t)}else if(DataCenter.instance.room.selfIsMaster){var t=App.RandomUtils.limitInteger(1,10);7>=t?App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"iswake",1):App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"noWake",1)}0==this.numtime&&(this.isGameOver=!0,this.numFoodSelfeat>this.numFoodEnumyeat?this.onResult():this.numFoodSelfeat<this.numFoodEnumyeat?this.onResult(1):this.numFoodSelfeat==this.numFoodEnumyeat&&(DataCenter.instance.room.selfIsMaster?this.onResult():this.onResult(1)))},e.prototype.onAddFoodCartoon=function(t){var e=this,o=new eui.Image;o.source=t.source,o.anchorOffsetX=t.anchorOffsetX,o.anchorOffsetY=t.anchorOffsetY,o.horizontalCenter=t.horizontalCenter,o.bottom=t.bottom+140,t.parent.addChild(o),egret.Tween.get(o).to({bottom:t.bottom},50).call(function(){egret.Tween.removeTweens(e.img_mark),t.parent.removeChild(o)})},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.onBossWillComming=function(t){var e=this;egret.Tween.get(this.img_mark).to({alpha:1},200).to({alpha:0},200).to({alpha:1},200).to({alpha:0},200).to({alpha:1},200).to({alpha:0},200).call(function(){egret.Tween.removeTweens(e.img_mark),7>=t&&e.onArrest()})},e.prototype.onInitFood=function(){if(DataCenter.instance.room.selfIsMaster)for(var t=0;14>t;++t){var e=App.RandomUtils.limitInteger(1,3);this.Arr_food.push(e);var o=App.RandomUtils.limitInteger(-10,10);this.Arr_food_Shift.push(o)}this.setFood()},e.prototype.setFood=function(){for(var t=0;14>t;++t)if(7>t){this["food_1_"+(t+1)].source="greedy_food"+this.Arr_food[t]+"_png",this["food_1_"+(t+1)].horizontalCenter=this.Arr_food_Shift[t];var e,o;switch(this.Arr_food[t]){case 1:e=97,o=32.6;break;case 2:e=107.5,o=30;break;case 3:e=104,o=28}this["food_1_"+(t+1)].anchorOffsetX=e,this["food_1_"+(t+1)].anchorOffsetY=o}else{this["food_2_"+(t-6)].source="greedy_food"+this.Arr_food[t]+"_png",this["food_2_"+(t-6)].horizontalCenter=this.Arr_food_Shift[t];var e,o;switch(this.Arr_food[t]){case 1:e=97,o=32.6;break;case 2:e=107.5,o=30;break;case 3:e=104,o=28}this["food_2_"+(t-6)].anchorOffsetX=e,this["food_2_"+(t-6)].anchorOffsetY=o}},e.prototype.onlefteat=function(){if(!this.isGameOver){if(this.isBossXing)return void(this.Caught_Self=!0);var t="speedy_eat1_mp3";App.SoundManager.playEffect(t),this.numFoodSelfeat++,this.onReduceFood(),1==this.onSelfLocation?(this["arm_"+this.onSelfLocation].play("d",1),this["person_"+this.onSelfLocation].play("d",1)):(this["person_"+this.onSelfLocation].play("c",1),this["arm_"+this.onSelfLocation].play("c",1)),this.onCheckWhoisWin()}},e.prototype.onRighteat=function(){if(!this.isGameOver){if(this.isBossXing)return void(this.Caught_Self=!0);var t="speedy_eat2_mp3";App.SoundManager.playEffect(t),this.numFoodSelfeat++,this.onReduceFood(),1==this.onSelfLocation?(this["person_"+this.onSelfLocation].play("c",1),this["arm_"+this.onSelfLocation].play("c",1)):(this["person_"+this.onSelfLocation].play("d",1),this["arm_"+this.onSelfLocation].play("d",1)),this.onCheckWhoisWin()}},e.prototype.onAiAttack=function(){this.isGameOver||this.Caught_Enumy||this.isBossXing&&this.numAiAttack%10>3||(this.numAiAttack++,this.numAiAttack%2==0?this.onEnumylefteat():this.onEnumyRighteat())},e.prototype.onEnumylefteat=function(){if(!this.Caught_Enumy){if(this.isBossXing)return void(this.Caught_Enumy=!0);var t="speedy_eat1_mp3";App.SoundManager.playEffect(t),this.numFoodEnumyeat++,this.onReduceFood(1),1==this.onEnumyLocation?(this["arm_"+this.onEnumyLocation].play("d",1),this["person_"+this.onEnumyLocation].play("d",1)):(this["person_"+this.onEnumyLocation].play("c",1),this["arm_"+this.onEnumyLocation].play("c",1)),this.onCheckWhoisWin()}},e.prototype.onEnumyRighteat=function(){if(!this.Caught_Enumy){if(this.isBossXing)return void(this.Caught_Enumy=!0);var t="speedy_eat1_mp3";App.SoundManager.playEffect(t),this.numFoodEnumyeat++,this.onReduceFood(1),1==this.onEnumyLocation?(this["person_"+this.onEnumyLocation].play("c",1),this["arm_"+this.onEnumyLocation].play("c",1)):(this["person_"+this.onEnumyLocation].play("d",1),this["arm_"+this.onEnumyLocation].play("d",1)),this.onCheckWhoisWin()}},e.prototype.onCheckWhoisWin=function(){140==this.numFoodEnumyeat?(this.isGameOver=!0,console.log("你输了"),this.onResult(1)):140==this.numFoodSelfeat&&(this.isGameOver=!0,console.log("你赢了"),this.onResult()),this.isGameOver&&(this.touchEnabled=!1,this.touchChildren=!1)},e.prototype.onReduceFood=function(t){if(void 0===t&&(t=0),0==t)if(this.numFoodSelfeat%20!=0){var e=Math.floor(this.numFoodSelfeat/20)+1,o=this["food_"+this.onSelfLocation+"_"+e];o&&this.onEatCartoon(o)}else this["food_"+this.onSelfLocation+"_"+this.numFoodSelfeat/20].visible=!1;else if(console.log("敌人吃的食物数量:",this.numFoodEnumyeat),this.numFoodEnumyeat%20!=0){var e=Math.floor(this.numFoodEnumyeat/20)+1,o=this["food_"+this.onEnumyLocation+"_"+e];o&&this.onEatCartoon(o)}else this["food_"+this.onEnumyLocation+"_"+this.numFoodEnumyeat/20].visible=!1},e.prototype.onEatCartoon=function(t){egret.Tween.removeTweens(t),t.scaleX=1,t.scaleY=1,egret.Tween.get(t).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.removeTweens(t)})},e.prototype.onAddFoodToEnumy=function(){if(!this.isGameOver){if(this.numChaoFengFrist&&(this.numFoodEnumyeat=this.numFoodEnumyeat-this.numFoodEnumyeat%20,this.numChaoFengFrist=!1,this.iswhoChaoFeng=!0),this.numFoodEnumyeat-=2,this.numFoodEnumyeat<=0)this.numFoodEnumyeat=0,this["food_"+this.onEnumyLocation+"_1"].alpha=1,this.onShouTiShi(this.onSelfLocation),console.log("出牌子");else{var t=this.numFoodEnumyeat%20,e=Math.floor(this.numFoodEnumyeat/20)+1;0==t?this["food_"+this.onEnumyLocation+"_"+e].alpha=1:(this["food_"+this.onEnumyLocation+"_"+e].visible=!0,this["food_"+this.onEnumyLocation+"_"+e].alpha=.5,this.onAddFoodCartoon(this["food_"+this.onEnumyLocation+"_"+e]),this.ImageYing=this["food_"+this.onEnumyLocation+"_"+e])}console.log("嘲讽改变敌人食物数量：~~",this.numFoodEnumyeat)}},e.prototype.onAddFoodToSelf=function(){if(this.numChaoFengFrist&&(this.numFoodSelfeat=this.numFoodSelfeat-this.numFoodSelfeat%20,this.numChaoFengFrist=!1,this.iswhoChaoFeng=!1),this.numFoodSelfeat-=2,this.numFoodSelfeat<=0)this.numFoodSelfeat=0,this["food_"+this.onSelfLocation+"_1"].alpha=1,console.log("出牌子"),this.onShouTiShi(this.onEnumyLocation);else{var t=this.numFoodSelfeat%20,e=Math.floor(this.numFoodSelfeat/20)+1;0==t?this["food_"+this.onSelfLocation+"_"+e].alpha=1:(this["food_"+this.onSelfLocation+"_"+e].visible=!0,this["food_"+this.onSelfLocation+"_"+e].alpha=.5,this.ImageYing=this["food_"+this.onSelfLocation+"_"+e],this.onAddFoodCartoon(this["food_"+this.onSelfLocation+"_"+e]))}console.log("被嘲讽改变自己食物数量：~~",this.numFoodSelfeat)},e.prototype.onShouTiShi=function(t){var e=this;this["gp_Chao"+t].alpha=1,egret.Tween.removeTweens(this["gp_Chao"+t]),egret.Tween.get(this["gp_Chao"+t]).to({alpha:0},200).call(function(){egret.Tween.removeTweens(e["gp_Chao"+t])})},e.prototype.onNoticeChaoFeng=function(){if(!this.isGameOver){var t="ChaoFeng"+this.onEnumyLocation;App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,t,1)}},e.prototype.onArrest=function(){this.dbBoss.play("b",1),this.isBossXing=!0,(DataCenter.instance.room.selfIsMaster||DataCenter.instance.room.IsAI)&&App.TimerManager.doTimer(500,1,this.onBossReaction,this),this.person_1.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate1,this),this.person_2.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate2,this)},e.prototype.onBossReaction=function(){this.Caught_Enumy&&this.Caught_Self?DataCenter.instance.room.IsAI?(this.onCatchDouble(),this.onChangeButton(3),App.TimerManager.doTimer(750,1,this.onReleaseDouble,this)):DataCenter.instance.room.selfIsMaster&&App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"CatchDouble",1):!this.Caught_Enumy&&this.Caught_Self?DataCenter.instance.room.IsAI?(this.onCatchOne(),this.onChangeButton(3),this.onAIChaoFeng(),App.TimerManager.doTimer(this.num_time_ChaoFeng,1,this.onReleaseDouble,this)):DataCenter.instance.room.selfIsMaster&&App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"CatchPlayer1",1):this.Caught_Enumy&&!this.Caught_Self?DataCenter.instance.room.IsAI?(this.onCatchTwo(),this.onChangeButton(1),App.TimerManager.doTimer(this.num_time_ChaoFeng,1,this.onReleaseDouble,this)):DataCenter.instance.room.selfIsMaster&&App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"CatchPlayer2",1):this.Caught_Enumy||this.Caught_Self||(DataCenter.instance.room.IsAI?0==this.num_BossChecktime?(this.num_BossChecktime=1,this.onNoCatchany(),App.TimerManager.doTimer(500,1,this.onBossCheckAgain,this)):this.onReleaseDouble():DataCenter.instance.room.selfIsMaster&&(0==this.num_BossChecktime?App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"CatchNO",1):App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"CatchNOAgain",1)))},e.prototype.onAIChaoFeng=function(){App.TimerManager.doTimer(160,22,this.onAddFoodToSelf,this)},e.prototype.onBossCheckAgain=function(){this.onBossReaction()},e.prototype.onReleaseDouble=function(){this.person_1.play("a",0),this.person_2.play("a",0),this.dbBoss.play("a",0),this.Caught_Enumy=!1,this.Caught_Self=!1,this.isBossXing=!1,this.numChaoFengFrist||(this.numChaoFengFrist=!0,this.ImageYing&&.5==this.ImageYing.alpha&&(this.ImageYing.visible=!1),this.iswhoChaoFeng?this.numFoodEnumyeat%20!=0&&(this.numFoodEnumyeat=20*(Math.floor(this.numFoodEnumyeat/20)+1)):this.numFoodSelfeat%20!=0&&(this.numFoodSelfeat=20*(Math.floor(this.numFoodSelfeat/20)+1))),this.onChangeButton(2),console.log("开心》》",this.numFoodEnumyeat,this.numFoodSelfeat),this.num_BossChecktime=0,this.person_1.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate1,this),this.person_2.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate2,this)},e.prototype.onCatchOne=function(){this.person_1.play("f",0),this.person_2.play("e",0),this.dbBoss.play("c",0);var t="speedy_ku_mp3";App.SoundManager.playEffect(t)},e.prototype.onCatchTwo=function(){this.person_1.play("e",0),this.person_2.play("f",0),this.dbBoss.play("d",0);var t="speedy_ku_mp3";App.SoundManager.playEffect(t)},e.prototype.onCatchDouble=function(){this.person_1.play("f",0),this.person_2.play("f",0),this.dbBoss.play("e",0);var t="speedy_ku_mp3";App.SoundManager.playEffect(t)},e.prototype.onNoCatchany=function(){this.person_1.play("b",0),this.person_2.play("b",0),this.dbBoss.play("b",0)},e.prototype.onResult=function(t){var e=this;void 0===t&&(t=0);var o=new eui.Image;this.containerGroup.addChild(o),o.horizontalCenter=0,o.verticalCenter=0,0==t?o.source="win_png":o.source="fail_png",egret.Tween.get(o).to({scaleX:1.2,scaleY:1.2},500).to({scaleX:1,scaleY:1},1e3).wait(1e3).call(function(){egret.Tween.removeTweens(o),e.containerGroup.removeChild(o),0==t?e.gameOver(3):e.gameOver(1)})},e.prototype.onChaoFengOne=function(){},e.prototype.onChaoFengTwo=function(){},e.prototype.onChangeButton=function(t){switch(void 0===t&&(t=2),this.chaofengBtn.visible=!1,this.btn_lefteat.visible=!1,this.btn_righteat.visible=!1,t){case 1:this.chaofengBtn.visible=!0;break;case 2:this.btn_lefteat.visible=!0,this.btn_righteat.visible=!0;break;case 3:}},e.prototype.addAllDb=function(){this.dbBoss=AssetManager.getQuickDBArmature("boss"),this.dbBoss.x=this.gp_boss.width/2,this.dbBoss.y=470,this.gp_boss.addChild(this.dbBoss),this.dbBoss.play("a",0),this.person_1=AssetManager.getQuickDBArmature("left"),this.person_1.x=this.gp_person1.width/2,this.person_1.y=250,this.gp_person1.addChild(this.person_1),this.person_1.play("a",0),this.arm_1=AssetManager.getQuickDBArmature("left_hand"),this.arm_1.x=this.gp_arm1.width/2,this.arm_1.y=0,this.gp_arm1.addChild(this.arm_1),this.arm_1.play("a",0),this.person_2=AssetManager.getQuickDBArmature("right"),this.person_2.x=this.gp_person2.width/2,this.person_2.y=250,this.gp_person2.addChild(this.person_2),this.person_2.play("a",0),this.arm_2=AssetManager.getQuickDBArmature("right_hand"),this.arm_2.x=this.gp_arm2.width/2,this.arm_2.y=0,this.gp_arm2.addChild(this.arm_2),this.arm_2.play("a",0),this.person_1.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate1,this),this.person_2.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayComplate2,this)},e.prototype.onPlayComplate1=function(){this.person_1.play("a",1)},e.prototype.onPlayComplate2=function(){this.person_2.play("a",1)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.GAME_WIDTH=640,e.GAME_HEIGHT=1136,e}(StateEui);__reflect(GameGreedyPersonView.prototype,"GameGreedyPersonView");