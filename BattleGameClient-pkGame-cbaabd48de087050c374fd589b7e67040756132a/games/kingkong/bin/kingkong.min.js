var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=App.GameWidth,this.stageHeight=App.GameHeight,this.halfStageWidth=this.stageWidth/2,this.halfStageHeight=this.stageHeight/2},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=AssetManager.getBitmap(t),this.background&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var GameKingkong=function(t){function e(){var e=t.call(this)||this;return e._uiContainer=new egret.DisplayObjectContainer,e._progress1=new DBProgress(AssetManager.getDBArmature("progress1")),e._progress2=new DBProgress(AssetManager.getDBArmature("progress2")),e}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.bg="bg_jpg",this.background.height>App.GameHeight&&(this.background.height=App.GameHeight,this.background.anchorOffsetY=this.background.height/2,this.background.y=App.GameHeight/2);var i=AssetManager.getBitmap("blackMask_png",!1,!1);i.width=i.height=App.GameWidth,i.anchorOffsetY=i.height,i.y=(App.GameHeight-this.background.height)/2;var n=AssetManager.getBitmap("blackMask_png",!1,!1);n.width=n.height=App.GameWidth,n.y=App.GameHeight-(App.GameHeight-this.background.height)/2,this._sceneLeft=new KingkongScene(this.background.width,this.background.height,!0),this._sceneRight=new KingkongScene(this.background.width,this.background.height),App.SoundManager.playBg("kingkongBgMusic_mp3"),DataCenter.instance.room.IsAI?this._sceneRight.mode=KingkongScene.MODE_AI:this._sceneRight.mode=KingkongScene.MODE_NET,this._sceneRight.self=!1,this._sceneRight.scaleX=-1,this._sceneRight.scaleY=-1,this._sceneRight.x=this.background.width,this._sceneRight.y=this.background.height+(App.GameHeight-this.background.height)/2,this._uiContainer.width=this.background.width,this._uiContainer.height=this.background.height,this._uiContainer.anchorOffsetY=this._uiContainer.height/2,this._uiContainer.anchorOffsetX=this._uiContainer.width/2,this._uiContainer.x=App.GameWidth/2,this._uiContainer.y=App.GameHeight/2,this._conBitmap=AssetManager.getBitmap("spaceBg_png",!1,!1),this._conBitmap.width=App.GameWidth,this._conBitmap.height=App.GameHeight,this.addChild(this._conBitmap),this._sceneLeft.y=(App.GameHeight-this.background.height)/2,this.addChild(this._sceneRight),this.addChild(this._sceneLeft),this.addChild(this._uiContainer),this._progress1.x=this.background.width,this._progress1.y=this.background.height/2,this._progress1.rotation=90,this._progress2.x=this.background.width,this._progress2.y=this.background.height/2,this._progress2.rotation=90,this._uiContainer.addChild(this._progress2),this._uiContainer.addChild(this._progress1);var s=AssetManager.getBitmap("mask_png");s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height,s.x=this._progress1.x-5,s.y=this._progress1.y-280,this._uiContainer.addChild(s);var o=AssetManager.getBitmap("mask_png");o.anchorOffsetX=o.width/2,o.anchorOffsetY=0,o.x=this._progress1.x-5,o.y=this._progress1.y+280,this._uiContainer.addChild(o);var h=AssetManager.getBitmap("winLine_jpg");h.anchorOffsetX=h.width/2,h.anchorOffsetY=0,h.x=this._progress1.x+1,h.y=this._progress1.y-270,this._uiContainer.addChild(h),App.IsXiaoMi||App.IsWanba||(this.returnToLastButton=AssetManager.getBitmap("goBack_png",!1,!1),this.returnToLastButton.y=19,this._uiContainer.addChild(this.returnToLastButton),this.returnToLastButton.touchEnabled=!0,this.returnToLastButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.popup("GameSureLeave")},this)),this.addChild(i),this.addChild(n),this._conBitmap.touchEnabled=!0,this._conBitmap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.addEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.addEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.addEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneRight.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BANANA,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_JUMP,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT_GROUND,this.onMasterEvent,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.addListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this)},e.prototype.onMasterEvent=function(t){if(this._sceneRight.mode==KingkongScene.MODE_NET){t.data;switch(t.type){case KingkongScene.EVENT_BOOM:App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"boom");break;case KingkongScene.EVENT_GET_BANANA:App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"getBanana");break;case KingkongScene.EVENT_GET_BOOM:App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"getBoom");break;case KingkongScene.EVENT_JUMP:App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"jump");break;case KingkongScene.EVENT_SHOOT:App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"shoot");break;case KingkongScene.EVENT_SHOOT_GROUND:}}},e.prototype.onGameEvent=function(t){if(t.userId!=DataCenter.instance.user.id)switch(t.event){case"getBoom":this._sceneRight.kingkongGetBoom();break;case"getBanana":this._sceneRight.kingkongGetBanana();break;case"boom":this._sceneRight.kingkongHit();break;case"jump":this._sceneRight.kingkongJump();break;case"shoot":this._sceneRight.kingkongShoot()}},e.prototype.stop=function(){this.isStop||(this.isStop=!0,this._progress1.progress=0,this._progress2.progress=0,this._sceneLeft.dispose(),this._sceneRight.dispose())},e.prototype.onGameOver=function(t){this.stop(),App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,this._win)},e.prototype.onGameResult=function(t){DataCenter.instance.room.gameResult=t,this.popup("GameResult",null)},e.prototype.onGameStart=function(t){this._win=1,this._sceneRight.startRun()},e.prototype.onLeftWin=function(t){this._win=3,this._sceneRight.fail()},e.prototype.onRightWin=function(t){this._win=1,this._sceneLeft.fail()},e.prototype.onLeftShoot=function(t){this._sceneLeft.fireBoom(this._sceneRight.addBoom)},e.prototype.onRightShoot=function(t){this._sceneRight.fireBoom(this._sceneLeft.addBoom)},e.prototype.onTouchBegin=function(t){t.stageX<this.background.width/2?t.stageY>this.background.height/2?this._sceneLeft.touchLeft():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchRight():t.stageY>this.background.height/2?this._sceneLeft.touchRight():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchLeft()},e.prototype.tick=function(t){this._sceneLeft.gameStart&&(this._progress2&&(this._progress2.progress=this._sceneLeft.progress),this._progress1&&(this._progress1.progress=this._sceneRight.progress))},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._conBitmap.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.removeEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.removeEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneRight.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.dispose(),this._sceneRight.dispose(),ObjectPool.clearClass("KingkongItem")},e}(StateBG);__reflect(GameKingkong.prototype,"GameKingkong");var KingkongScene=function(t){function e(e,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=null);var o=t.call(this)||this;o._totalDistance=35570,o._curItemConfigs=[],o._curItems=[],o._kingkongPosMinY=1521,o._kingkongPosMaxY=1900,o._fastLastTime=3,o.self=!0,o._kingkongOffsetY=240,o._curLevel=1,o._invincibleTime=0,o.progress=0,o.fireBoom=function(t){var e=ObjectPool.pop(KingkongItem,"KingkongItem");e.type=KingkongItem.TYPE_FIRE_BOOM,e.x=0,o.master?(e.y=o.stageHeight-o._kingkongOffsetY,App.SoundManager.playEffect("renglei2_mp3",!0)):(e.y=o.stageHeight-o._kingkongOffsetY-100,App.SoundManager.playEffect("renglei_mp3",!0)),o._itemContainer.addChild(e);var i=egret.Tween.get(e);i.to({x:-o.stageWidth/3,scaleX:2,scaleY:2,rotation:90},250),i.to({x:-o.stageWidth/4*3,scaleX:1,scaleY:1,rotation:180},250),i.call(function(){e.parent&&e.parent.removeChild(e),t()})},o.addBoom=function(){var t=ObjectPool.pop(KingkongItem,"KingkongItem");t.type=KingkongItem.TYPE_FIRE_BOOM,t.x=0,o.master?t.y=o._kingkongOffsetY:t.y=o._kingkongOffsetY+100,o._itemContainer.addChild(t),o.addBoomComplete(t)},o.master=n,o.stageWidth=e,o.stageHeight=i,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAdded,o),o._building=new Building,o._kingkong=new Kingkong(n),o.master||(o._kingkongOffsetY-=100),o._itemContainer=new egret.DisplayObjectContainer,s?o._uiContainer=s:o._uiContainer=new egret.DisplayObjectContainer,o.btnJump=AssetManager.getDBArmature("tiaoyue"),o.btnShoot=AssetManager.getDBArmature("renglei"),o._tip=AssetManager.getDBArmature("tishi");var h;return h=o.master?DataCenter.instance.user:DataCenter.instance.room.player,o._avatar=new RoleAvatar(h.curAvatarType,h.imgUrl,"dbxiaoren00_game1").armature,o._chain=AssetManager.getBitmap("chain_png"),o}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t,this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameStart",{get:function(){return this._gameStart},enumerable:!0,configurable:!0}),e.prototype.addTip=function(){var t=this;this._tip&&(this._tip.play("tishi2",0),this.tipFlag=setTimeout(function(){t.removeTip()},2e3),this._tip.x=this.btnJump.x,this._tip.y=this.btnJump.y,this._uiContainer.addChild(this._tip))},e.prototype.removeTip=function(){this._tip&&this._tip.parent&&(this._tip.stop(),this._tip.parent.removeChild(this._tip),clearTimeout(this.tipFlag),this.tipFlag=void 0)},e.prototype.onAdded=function(t){this.init()},e.prototype.dispose=function(){App.TimerManager.remove(this.advanceTime,this),this.removeAllItems(),this._itemContainer.removeChildren(),this.tipFlag&&clearTimeout(this.tipFlag)},e.prototype.init=function(){var t=RES.getRes("levelConfig_json").level[this._curLevel];this._curItemConfigs=t.concat(),this._building.x=this.stageWidth,this._building.y=this.stageHeight,this.addChild(this._building),this._building.stop(),this._avatar.x=this.stageWidth/2,this._avatar.y=this.stageHeight/2+200,this._avatar.scaleX=this._avatar.scaleY=.7,this.addChild(this._avatar),this._chain.x=this._avatar.x,this._chain.y=this._avatar.y,this._chain.scaleX=this._chain.scaleY=.7,this.addChild(this._chain),this._uiContainer.x=0,this._uiContainer.y=0,this.addChild(this._uiContainer),this.btnJump.x=this.btnShoot.x=.5*this.stageWidth,this.btnJump.y=this.btnShoot.y=this.stageHeight-40,this._uiContainer.addChild(this.btnJump),this._uiContainer.addChild(this.btnShoot),this.addChild(this._itemContainer),this._itemContainer.x=this.stageWidth-60,this._itemContainer.y=0,this.master||(this.btnJump.visible=!1,this.btnShoot.visible=!1),this._kingkong.x=this.stageWidth-60,this._kingkong.y=this.stageHeight-this._kingkongOffsetY,this._kingkongPosY=this._kingkong.y,this._kingkongPosMaxY=this._kingkongPosY+Kingkong.LEG_LENGTH+KingkongItem.HALF_SIZE,this._kingkongPosMinY=this._kingkongPosY-Kingkong.LEG_LENGTH-KingkongItem.HALF_SIZE,this.addChild(this._kingkong),this._kingkong.stand(),this._totalDistance=this.configToD(this._curItemConfigs[this._curItemConfigs.length-1].d)+this.stageHeight-this._kingkongOffsetY,this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3),this.master&&this.preStart(),App.TimerManager.doTimer(1,0,this.advanceTime,this)},e.prototype.initAI=function(t){this._mode==e.MODE_AI&&(null==this._ai&&(this._ai=new AIKingkong,this._ai.addEventListener(Kingkong.EVENT_SHOOT,this.onAIShoot,this),this._ai.addEventListener(Kingkong.EVENT_JUMP,this.onAIJump,this)),this._ai.level=t,this._ai.kingkong=this._kingkong,this._ai.curItems=this._curItems)},e.prototype.onAIShoot=function(t){this.touchLeft()},e.prototype.onAIJump=function(t){this.touchRight()},e.prototype.advanceTime=function(t){return this._gameStart&&(this._building.advanceTime(t),this._curTime+=t,this._curDistance=this._building.curDistance,this.addItems(),this.moveItems(),this.removeItems(),this.testHit(),this._fast&&this.checkFast(t),this.checkWin(),this.progress=this._curDistance/this._totalDistance,this._mode==e.MODE_AI&&this._ai.advanceTime(t),this._invincibleTime>0&&(this._invincibleTime-=t)),!0},e.prototype.checkWin=function(){this._curDistance>this._totalDistance&&this.win()},e.prototype.fail=function(){this._kingkong.getBoom(!1),this.btnShoot.play("renglei0",1),this.removeTip(),this.gameOver()},e.prototype.win=function(){var t=this;if(this.key){this.key.x+=this._itemContainer.x,this.key.y+=this._itemContainer.y,this._uiContainer.addChild(this.key);var e=egret.Tween.get(this.key),i=this._avatar.x-this.key.x,n=this._avatar.y-this.key.y;e.to({x:this.key.x+i/2,y:this.key.y+n/2,scaleX:2,scaleY:2},500),e.to({x:this.key.x+i,y:this.key.y+n,scaleX:1,scaleY:1},500),e.call(function(){t._avatar.play("win"),t._chain.alpha=0,t.key.x=0,t.removeItem(t.key,0),t.key=null}),e.wait(1e3),e.call(function(){t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_OVER))})}this._kingkong.getBoom(!1),this.btnShoot.play("renglei0",1),this.removeTip(),this.dispatchEvent(new egret.Event(Kingkong.EVENT_WIN)),this.gameOver()},e.prototype.gameOver=function(){this._curDistance=0,this._fastLastTime=0,this._building.curDistance=0,this._curTime=0,this._gameStart=!1,this._building.stop(),this._kingkong.stand(),this.removeTip(),this._mode==e.MODE_AI&&this._ai.over(),this.tipFlag&&clearTimeout(this.tipFlag)},e.prototype.checkFast=function(t){this._fastLastTime>0?this._fastLastTime-=t:this.stopFast()},e.prototype.testHit=function(){var t,i,n,s,o;for(t=0,i=this._curItems.length;i>t;t++){if(this._curItems[t].type===KingkongItem.TYPE_WIN)return;if(!(this._curItems[t].type!=KingkongItem.TYPE_KEY&&this._curItems[t].y>this._kingkongPosMinY))break;if(this._curItems[t].y<this._kingkongPosMaxY&&!this._kingkong.onAir()&&!this._kingkong.invincible){o=this._curItems[t],n=!0,s=this._curItems[t].type,this.removeItem(o,t);break}}if(n&&this.mode!=e.MODE_NET)switch(s){case KingkongItem.TYPE_BANANA:this.kingkongGetBanana();break;case KingkongItem.TYPE_BOOM:this.kingkongGetBoom();break;case KingkongItem.TYPE_FIRE_BOOM:this._invincibleTime<=0&&(this.kingkongHit(),this._invincibleTime=e.INVINCIBLE_TIME)}},e.prototype.stopFast=function(){this._fast=!1,this._building.runNormal(),this._kingkong.runNormal()},e.prototype.kingkongGetBanana=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BANANA,!1,!1,this._curDistance)),this._fast=!0,this._slow=!1,App.SoundManager.playEffect("banana_mp3",!0),this._fastLastTime=e.FAST_TIME,this._building.runFast(),this._kingkong.runFast(),this._avatar.play("chi",1)},e.prototype.kingkongGetBoom=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BOOM,!1,!1,this._curDistance)),this._kingkong.getBoom(!0),this.btnShoot.play("renglei1",1),this.master&&!this.tipFlag&&this.addTip()},e.prototype.kingkongRecover=function(){this._slow=!1,this._fast=!1,this._building.runNormal(),this._kingkong.runNormal(),this._kingkong.removeEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this)},e.prototype.onKingkongRecover=function(t){this.kingkongRecover()},e.prototype.kingkongHit=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_BOOM,!1,!1,this._curDistance)),this._slow=!0,this._fast=!1,this._building.runSlow(),this._kingkong.runSlow(),this._kingkong.getBoom(!1),this.removeTip(),App.SoundManager.playEffect("kingkongBoom_mp3",!0),this.btnShoot.play("renglei0",1),this._kingkong.addEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this),this._kingkong.playHit(),this._avatar.play("zha",1)},e.prototype.disToConfig=function(t){return(this._curDistance-t)/100},e.prototype.configToD=function(t){return 100*t},e.prototype.addBoomComplete=function(t){t.pos=this.disToConfig(t.y),this.master||this.dispatchEvent(new egret.Event(e.EVENT_SHOOT_GROUND,!1,!1,t.pos)),this._lastAddedBoom=t;var i,n,s;for(i=0,n=this._curItems.length;n>i;i++)if(this._curItems[i].pos>t.pos){this._curItems.splice(i,0,t),s=!0;break}s||this._curItems.push(t)},e.prototype.addItems=function(){if(this._curItemConfigs.length>0)for(var t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t);i<this._curDistance;){this._curItemConfigs.shift();var n=ObjectPool.pop(KingkongItem,"KingkongItem");if(n.x=0,n.type=e,n.pos=t,n.type==KingkongItem.TYPE_KEY&&(this.key=n),this._itemContainer.addChild(n),this._curItems.push(n),!(this._curItemConfigs.length>0)){i=Number.MAX_VALUE;break}t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t)}},e.prototype.moveItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y=this._curDistance-this.configToD(i.pos)},e.prototype.removeItem=function(t,e){ObjectPool.push(t),this._curItems.splice(e,1),t.parent&&t.parent.removeChild(t)},e.prototype.removeItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y>this.stageHeight&&i.type!=KingkongItem.TYPE_KEY&&(ObjectPool.push(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i))},e.prototype.removeAllItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],ObjectPool.push(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i)},e.prototype.touchLeft=function(){this._kingkong.hasBoom&&this.kingkongShoot()},e.prototype.touchRight=function(){this._kingkong.jumpEnable()&&this.kingkongJump()},e.prototype.kingkongJump=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_JUMP,!1,!1,this._curDistance)),this._kingkong.jump(),App.SoundManager.playEffect("kingkongjump_mp3",!0),this.btnJump.play("tiaoyue",1),e.touched=!0},e.prototype.kingkongShoot=function(){var t=this;this.master&&this.dispatchEvent(new egret.Event(e.EVENT_SHOOT,!1,!1,this._curDistance));var i=function(){t.btnShoot.removeDisplayEvent(dragonBones.EventObject.COMPLETE,i,t),t.btnShoot.play("renglei0",1)};this.btnShoot.addDisplayEvent(dragonBones.EventObject.COMPLETE,i,this),this.btnShoot.play("renglei2",1),this._kingkong.getBoom(!1),this.removeTip(),this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),e.touched=!0},e.prototype.preStart=function(){var t=this,e=new GameReady(function(){t.startRun(),t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_START))});e.x=300,e.y=App.GameHeight/2,this.addChild(e),e.play()},e.prototype.startRun=function(){this._gameStart=!0,this._curTime=0,this.progress=0,this._building.reset(),this._kingkong.reset(),this._invincibleTime=0,this._curDistance=0,this._avatar&&this._avatar.play("newAnimation"),this._building.run(),this._kingkong.run(),this._mode==e.MODE_AI&&this._ai.start()},e.EVENT_SHOOT="kingkongScene:EVENT_SHOOT",e.EVENT_SHOOT_GROUND="kingkongScene:EVENT_SHOOT_GROUND",e.EVENT_JUMP="kingkongScene:EVENT_JUMP",e.EVENT_BOOM="kingkongScene:EVENT_BOOM",e.EVENT_GET_BOOM="kingkongScene:EVENT_GET_BOOM",e.EVENT_GET_BANANA="kingkongScene:EVENT_GET_BANANA",e.MODE_MANUAL=0,e.MODE_NET=1,e.MODE_AI=2,e.FAST_TIME=3e3,e.INVINCIBLE_TIME=1.1,e}(egret.DisplayObjectContainer);__reflect(KingkongScene.prototype,"KingkongScene");var AIKingkong=function(t){function e(){var e=t.call(this)||this;return e.level=0,e._nextRandomJumpTime=3,e._nextJumpTime=0,e._nextShootTime=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"kingkong",{set:function(t){this._kingkong=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curItems",{set:function(t){this._curItems=t},enumerable:!0,configurable:!0}),e.prototype.start=function(){this._kingkong&&this._curItems&&(this._running=!0)},e.prototype.over=function(){this._running=!1},e.prototype.advanceTime=function(t){this._running&&(this._kingkong.hasBoom&&(this._nextShootTime-=t,this._nextShootTime<0&&(this.kingkongCanShoot()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),this.resetNextShootTime())),this._kingkong.jumpEnable()&&(this.kingkongCanJump(t)?this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP)):(this._nextRandomJumpTime-=t,this._nextRandomJumpTime<0&&(this._nextRandomJumpTime=Math.random()*e.RANDOM_JUMP_TIME,this.randomJump()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP))))))},e.prototype.resetNextShootTime=function(){switch(this.level){case e.AI_LEVEL_0:this._nextShootTime=1*Math.random()+1;break;case e.AI_LEVEL_1:this._nextShootTime=.5*Math.random()+.5;break;case e.AI_LEVEL_2:this._nextShootTime=.5*Math.random()+.2;break;case e.AI_LEVEL_3:this._nextShootTime=.2*Math.random();break;default:this._nextShootTime=1}},e.prototype.kingkongCanShoot=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(.2>t)return!0;break;case e.AI_LEVEL_1:if(.4>t)return!0;break;case e.AI_LEVEL_2:if(.8>t)return!0;break;case e.AI_LEVEL_3:if(1.2>t)return!0;break;default:return!0}return!1},e.prototype.kingkongCanJump=function(t){if(this._curItems&&this._curItems.length>0){var i=this._kingkong.y-this._curItems[0].y;if(i>e.MIN_JUMP_DIS&&i<e.MAX_JUMP_DIS&&(this._nextJumpTime-=t,this._nextJumpTime<0)){var n=Math.random();switch(this.level){case e.AI_LEVEL_0:if(this._nextJumpTime=.1*Math.random()+.3,.2>n)return!0;break;case e.AI_LEVEL_1:if(this._nextJumpTime=.1*Math.random()+.2,.5>n)return!0;break;case e.AI_LEVEL_2:if(this._nextJumpTime=.1*Math.random()+.1,.8>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;case e.AI_LEVEL_3:if(1.2>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;default:return!0}}}return!1},e.prototype.randomJump=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(t>.2)return!1;break;case e.AI_LEVEL_1:if(.4>t)return!1;break;case e.AI_LEVEL_2:if(.8>t)return!1;break;case e.AI_LEVEL_3:if(1.2>t)return!1;break;default:return!1}return!0},e.AI_LEVEL_0=0,e.AI_LEVEL_1=1,e.AI_LEVEL_2=2,e.AI_LEVEL_3=3,e.MAX_JUMP_DIS=340,e.MIN_JUMP_DIS=100,e.RANDOM_JUMP_TIME=3,e}(egret.EventDispatcher);__reflect(AIKingkong.prototype,"AIKingkong");var Building=function(t){function e(){var e=t.call(this)||this;e._offset=1195;var i="ground";return e.dbBuilding=AssetManager.getDBArmature(i),e._bone=e.dbBuilding.getBone("bone"),e.addChild(e.dbBuilding),e.stop(),e.reset(),e}return __extends(e,t),e.prototype.reset=function(){this._curD=this._bone.globalTransformMatrix.ty,this._lastD=this._curD,this.tickDistance=0,this.curDistance=0},e.prototype.advanceTime=function(t){for(this._curD=this._bone.globalTransformMatrix.ty,this.tickDistance=this._curD-this._lastD;this.tickDistance<0;)this.tickDistance+=this._offset;this._lastD=this._curD,this.curDistance+=this.tickDistance},e.prototype.runNormal=function(){var t=egret.Tween.get(this.dbBuilding);t.to({timeScale:e.NORMAL_SPEED},500)},e.prototype.runFast=function(){var t=egret.Tween.get(this.dbBuilding);t.to({timeScale:e.FAST_SPEED},500)},e.prototype.runSlow=function(){this.dbBuilding.timeScale=0},e.prototype.run=function(){this.dbBuilding.play("run"),this.runSlow(),this.runNormal(),this.reset()},e.prototype.stop=function(){this.dbBuilding.stop()},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Building.prototype,"Building");var Kingkong=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this,n=e?"kingkong":"kingkongBlue";i.dbKingkong=AssetManager.getDBArmature(n),i.dbKingkong.scaleX=i.dbKingkong.scaleY=1.2,i._dust=AssetManager.getDBArmature("dust"),i._dust&&(i._dust.timeScale=1.5),i._bananaPeel=AssetManager.getDBArmature("bananaPeel"),i._bananaPeel.timeScale=1.5,i._bananaPeel.gotoAndStop("run"),i.addChild(i.dbKingkong);var s=i.dbKingkong.getSlot("boom");return s&&(i.boomArmature=s.childArmature),i.dbKingkong.replaceSlot("dust",i._dust),i.dbKingkong.replaceSlot("bananaPeel",i._bananaPeel),i}return __extends(e,t),e.prototype.onAir=function(){return this._status==e.STATUS_JUMP&&this._jumpState&&this._jumpState.currentTime>.17&&this._jumpState.currentTime<1.5?!0:!1},e.prototype.run=function(){this.invincible=!1,this._status=e.STATUS_RUN,this.dbKingkong.timeScale=e.NORMAL_SPEED,this._fast?(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.FAST_SPEED},500)):this._slow?this.dbKingkong.timeScale=e.SLOW_SPEED:this.dbKingkong.timeScale=e.NORMAL_SPEED,this.dbKingkong.play("run",0)},e.prototype.playHit=function(){this._speedTw&&egret.Tween.removeTweens(this.dbKingkong),this.invincible=!0,this._fast=!1,this._status=e.STATUS_HIT,this.dbKingkong.timeScale=e.NORMAL_SPEED,this.dbKingkong.play("boom",1),this.dbKingkong.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.onBoomComplete=function(t){this.dispatchEvent(new egret.Event(e.EVENT_RECOVER)),this.run(),this.dbKingkong.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.jumpEnable=function(){return this._status==e.STATUS_RUN},e.prototype.jump=function(){this._speedTw&&egret.Tween.removeTweens(this.dbKingkong),this.invincible=!1,this._status=e.STATUS_JUMP,this.dbKingkong.timeScale=e.NORMAL_SPEED,this._jumpState=this.dbKingkong.play("jump",1),this.dbKingkong.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this);var t=Math.floor(7*Math.random())+1;this._dust.play("boom"+t,1)},e.prototype.runFast=function(){this._fast=!0,this._slow=!1,this._bananaPeel&&this._bananaPeel.play("run",1),this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.FAST_SPEED},500))},e.prototype.runSlow=function(){this._slow=!0,this._fast=!1,this._status==e.STATUS_RUN&&(this.dbKingkong.timeScale=e.SLOW_SPEED)},e.prototype.runNormal=function(){this._fast=!1,this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.NORMAL_SPEED},500),this.dbKingkong.timeScale=e.NORMAL_SPEED)},e.prototype.onJumpComplete=function(t){this._fast?this.dbKingkong.timeScale=e.FAST_SPEED:this._slow?this.dbKingkong.timeScale=e.SLOW_SPEED:this.dbKingkong.timeScale=e.NORMAL_SPEED,this.run(),this.dbKingkong.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this)},e.prototype.stand=function(){this.invincible=!0,this._status=e.STATUS_STAND,this.dbKingkong.gotoAndStop("stand")},e.prototype.getBoom=function(t){if(this.hasBoom=t,this.boomArmature){var e=this.hasBoom?"boom1":"boom0";this.boomArmature.animation.gotoAndStop(e)}},e.prototype.reset=function(){this._fast=!1,this._slow=!1,this.invincible=!1},e.EVENT_RECOVER="EVENT_RECOVER",e.EVENT_SHOOT="EVENT_SHOOT",e.EVENT_JUMP="EVENT_JUMP",e.EVENT_WIN="EVENT_WIN",e.EVENT_GAME_START="EVENT_GAME_START",e.EVENT_GAME_OVER="EVENT_GAME_OVER",e.STATUS_RUN=0,e.STATUS_JUMP=1,e.STATUS_HIT=2,e.STATUS_STAND=3,e.STATUS_OVER=4,e.ARM_LENGTH=84,e.LEG_LENGTH=60,e.LENGTH=e.ARM_LENGTH+e.LEG_LENGTH,e.NORMAL_SPEED=2,e.FAST_SPEED=3,e.SLOW_SPEED=1,e}(egret.Sprite);__reflect(Kingkong.prototype,"Kingkong");var KingkongItem=function(t){function e(){var e=t.call(this)||this,i="kingkongItem";return e._item=AssetManager.getQuickDBArmature(i),e._item.scaleX=e._item.scaleY=1.2,e.addChild(e._item),e}return __extends(e,t),e.prototype.reDraw=function(){var t=16711680;switch(this._item.stop(),this._type){case e.TYPE_BANANA:t=16776960,this._item.gotoAndStop("banana");break;case e.TYPE_BOOM:t=0,this._item.gotoAndStop("boom");break;case e.TYPE_FIRE_BOOM:t=16711680,this._item.play("fireBoom");break;case e.TYPE_KEY:t=16711680,this._item.gotoAndStop("key");break;case e.TYPE_WIN:t=16711680,this._item.gotoAndStop("qi");break;default:t=16777215,this._item.stop()}},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.reDraw()},enumerable:!0,configurable:!0}),e.TYPE_BANANA=0,e.TYPE_BOOM=1,e.TYPE_FIRE_BOOM=2,e.TYPE_KEY=3,e.TYPE_WIN=4,e.SIZE=75,e.HALF_SIZE=e.SIZE/2,e}(egret.Sprite);__reflect(KingkongItem.prototype,"KingkongItem");var ScoreData=function(){function t(){this._curBestHit=0,this._curGoodHit=0,this._curMissHit=0,this._curComboo=0,this.maxBestHit=0,this.maxGoodHit=0,this.maxMissHit=0,this.maxComboo=0}return Object.defineProperty(t.prototype,"curBestHit",{get:function(){return this._curBestHit},set:function(t){this._curBestHit=t,this.maxBestHit<this._curBestHit&&(this.maxBestHit=this._curBestHit),this.curComboo++,console.log("cur best:",this._curBestHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curGoodHit",{get:function(){return this._curGoodHit},set:function(t){this._curGoodHit=t,this.maxGoodHit<this._curGoodHit&&(this.maxGoodHit=this._curGoodHit),this.curComboo++,console.log("cur good:",this._curGoodHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curMissHit",{get:function(){return this._curMissHit},set:function(t){this._curMissHit=t,this.maxMissHit<this._curMissHit&&(this.maxMissHit=this._curMissHit),this._curComboo=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curComboo",{get:function(){return this._curComboo},set:function(t){this._curComboo=t,this.maxComboo<this._curComboo&&(this.maxComboo=this._curComboo),console.log("cur comboo:",this._curComboo)},enumerable:!0,configurable:!0}),t}();__reflect(ScoreData.prototype,"ScoreData");