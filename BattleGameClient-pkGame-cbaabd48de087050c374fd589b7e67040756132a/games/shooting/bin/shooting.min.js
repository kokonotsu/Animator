var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i},GameShootingView=function(e){function t(){var i=e.call(this)||this;return t.instance=i,i.background=AssetManager.getBitmap("background_png",!1,!1),i.adaptScaleY=App.GameHeight/i.background.height,i.background.height=App.GameHeight,i.basicLayer=new egret.DisplayObjectContainer,i.selfShields=new egret.DisplayObjectContainer,i.bulletsLayer=new egret.DisplayObjectContainer,i.competitorshields=new egret.DisplayObjectContainer,i.controlLayer=new ControlLayer,i.addChild(i.basicLayer),i.addChild(i.competitorshields),i.addChild(i.bulletsLayer),i.addChild(i.selfShields),i.addChild(i.controlLayer),i.roundBG=new egret.Shape,i.roundBG.alpha=0,i.roundBG.graphics.beginFill(0),i.roundBG.graphics.drawRect(0,0,App.GameWidth,App.GameHeight),i.roundBG.graphics.endFill(),i.addChild(i.roundBG),i.basicLayer.addChild(i.background),i.shootingGame=new GameShooting,i.shootingGame.init(),i.timeImg=new GameReady(t.instance.shootingGame.startTime),i.timeImg.x=300,i.timeImg.y=App.GameHeight/2,i.basicLayer.addChild(i.timeImg),i.timeImg.play(),i.result=new gameResultInGame,i.controlLayer.addChild(i.result),i}return __extends(t,e),t.prototype.resultWin=function(){this.result.win()},t.prototype.resultlose=function(){this.result.lose()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.timeImg.dispose(),this.controlLayer.dispose(),this.result.dispose(),this.shootingGame.dispose()},t}(State);__reflect(GameShootingView.prototype,"GameShootingView");var ControlLayer=function(e){function t(){var t=e.call(this)||this;return t.onKeyDown=function(e){console.log(e.keyCode),(65==e.keyCode||37==e.keyCode)&&t.leftButtonPress(),(68==e.keyCode||39==e.keyCode)&&t.rightButtonPress(),(87==e.keyCode||38==e.keyCode)&&t.fireButtonPress(),(83==e.keyCode||40==e.keyCode)&&t.shieldButtonTap()},t.onKeyUp=function(e){(65==e.keyCode||37==e.keyCode)&&t.directAreaRelease(),(68==e.keyCode||39==e.keyCode)&&t.directAreaRelease(),(87==e.keyCode||38==e.keyCode)&&t.fireButtonRelease()},t.leftButtonPress=function(){GameShootingView.instance.shootingGame.userController.walk=walkType.left,t.directArea.addEventListener(egret.TouchEvent.TOUCH_END,t.controlRelease,t),t.directArea.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.controlTouchMove,t)},t.rightButtonPress=function(){GameShootingView.instance.shootingGame.userController.walk=walkType.right,t.directArea.addEventListener(egret.TouchEvent.TOUCH_END,t.controlRelease,t),t.directArea.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.controlTouchMove,t)},t.controlPress=function(){t.directArea.addEventListener(egret.TouchEvent.TOUCH_END,t.controlRelease,t),t.directArea.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.controlTouchMove,t)},t.touchPoint=new egret.Point,t.controlTouchMove=function(e){return t.touchPoint.x=e.stageX,t.touchPoint.y=e.stageY,t.leftRect.containsPoint(t.touchPoint)?void(GameShootingView.instance.shootingGame.userController.walk=walkType.left):t.rightRect.containsPoint(t.touchPoint)?void(GameShootingView.instance.shootingGame.userController.walk=walkType.right):t.directAreaRect.containsPoint(t.touchPoint)?void(GameShootingView.instance.shootingGame.userController.walk=walkType.stand):void t.controlRelease()},t.controlRelease=function(){t.directArea.removeEventListener(egret.TouchEvent.TOUCH_END,t.controlRelease,t),t.directArea.removeEventListener(egret.TouchEvent.TOUCH_MOVE,t.controlTouchMove,t),GameShootingView.instance.shootingGame.userController.walk=walkType.stand},t.addUIButton(),t}return __extends(t,e),Object.defineProperty(t.prototype,"shield",{get:function(){return this._shield},set:function(e){e>=0&&3>=e&&(this._shield=e,this.shieldNumberImg.texture=AssetManager.getBitmap("D"+e+"_png").texture,0==e?this.shieldButton._armature.replaceSlot("shield",AssetManager.getBitmap("shieldGray_png")):this.shieldButton._armature.replaceSlot("shield",AssetManager.getBitmap("shield_png")))},enumerable:!0,configurable:!0}),t.prototype.addUIButton=function(){this.directArea=new egret.DisplayObjectContainer,App.IsXiaoMi||App.IsWanba||(this.returnToLastButton=AssetManager.getBitmap("goBack_png",!1,!1),this.returnToLastButton.y=19,this.addChild(this.returnToLastButton),this.returnToLastButton.touchEnabled=!0,this.returnToLastButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameShootingView.instance.popup("GameSureLeave")},this)),this.leftButton=new DBAnimButton(AssetManager.getQuickDBArmature("rightButton")),this.leftButton.scaleX=-1,this.directArea.addChild(this.leftButton),this.leftButton.x=10,this.leftButton.y=10,this.leftButton.touchEnabled=!0,this.leftButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.leftButtonPress,this),this.rightButton=new DBAnimButton(AssetManager.getQuickDBArmature("rightButton")),this.directArea.addChild(this.rightButton),this.rightButton.x=160,this.rightButton.y=10,this.rightButton.touchEnabled=!0,this.rightButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.rightButtonPress,this),this.directArea.x=80,this.directArea.y=GameShootingView.instance.background.height-100,this.addChild(this.directArea),this.touchEnabled=this.touchChildren=!0,this.directArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.controlPress,this),this.directArea.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.directAreaRelease,this);var e;e=this.leftButton.localToGlobal(this.leftButton.width/2-10,-this.leftButton.height/2+10,e),this.leftRect=new egret.Rectangle(e.x,e.y,this.leftButton.width,this.leftButton.height),e=this.rightButton.localToGlobal(-this.rightButton.width/2-10,-this.rightButton.height/2+10,e),this.rightRect=new egret.Rectangle(e.x,e.y,this.rightButton.width,this.rightButton.height),this.directArea.height+=20,this.directArea.width+=20,e=this.directArea.localToGlobal(10,-this.directArea.height/2+10,e),this.directAreaRect=new egret.Rectangle(e.x,e.y,this.directArea.width-20,this.directArea.height-20),this.shieldButton=new DBAnimButton(AssetManager.getQuickDBArmature("shieldButton")),this.shieldButton.x=400,this.shieldButton.y=GameShootingView.instance.background.height-100,this.addChild(this.shieldButton),this.shieldButton.touchEnabled=!0,this.shieldButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shieldButtonTap,this),this.shieldNumberImg=AssetManager.getBitmap("D3_png"),this.shieldNumberImg.x=this.shieldButton.x+this.shieldButton.width/4,this.shieldNumberImg.y=this.shieldButton.y-this.shieldButton.height/4,this.addChild(this.shieldNumberImg),this.fireButton=new DBAnimButton(AssetManager.getQuickDBArmature("fireButton")),this.fireButton.x=550,this.fireButton.y=GameShootingView.instance.background.height-100,this.addChild(this.fireButton),this.fireButton.touchEnabled=!0,this.fireButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.fireButtonPress,this),this.fireButton.addEventListener(egret.TouchEvent.TOUCH_END,this.fireButtonRelease,this),this.fireButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.fireButtonRelease,this),this.shield=UserConfig.shieldLimit,this.boom=AssetManager.getQuickDBArmature("boom"),this.boom.addDisplayEvent(dragonBones.EventObject.COMPLETE,this.boomOver,this)},t.prototype.directAreaRelease=function(){GameShootingView.instance.shootingGame.userController.walk=walkType.stand},t.prototype.fireButtonPress=function(){GameShootingView.instance.shootingGame.userController.startFire()},t.prototype.fireButtonRelease=function(){GameShootingView.instance.shootingGame.userController.stopFire()},t.prototype.shieldButtonTap=function(){GameShootingView.instance.shootingGame.userController.setShield()},t.prototype.dispose=function(){this.leftButton.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.leftButtonPress,this),this.rightButton.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.rightButtonPress,this),this.directArea.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.controlPress,this),this.fireButton.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.fireButtonPress,this),this.fireButton.removeEventListener(egret.TouchEvent.TOUCH_END,this.fireButtonRelease,this),this.fireButton.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.fireButtonRelease,this),this.directArea.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.directAreaRelease,this),this.shieldButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.shieldButtonTap,this),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.boom.dispose()},t.prototype.boomPlay=function(e,t){this.boom.x=e,this.boom.y=t,this.boom.play("boom",1),App.DisplayUtils.quickAddChild(this,this.boom)},t.prototype.boomOver=function(){App.DisplayUtils.quickRemoveChild(this.boom)},t}(egret.DisplayObjectContainer);__reflect(ControlLayer.prototype,"ControlLayer");var walkType;!function(e){e[e.left=0]="left",e[e.right=1]="right",e[e.stand=2]="stand"}(walkType||(walkType={}));var UserConfig=function(){function e(){}return e.frameTime=60,e.shieldLimit=3,e.shieldHP=6,e.bulletLimit=9,e.bulletSpeed=50,e.reloadBullet=2e3,e.ItemSpeed=10,e.walkSpeed=8,e.scores=3,e.splitRotation=15,e.AITime=250,e.ItemTime=1500,e}();__reflect(UserConfig.prototype,"UserConfig");var ItemType;!function(e){e[e.common=0]="common",e[e.rocket=1]="rocket",e[e.split=2]="split",e[e.shield=3]="shield"}(ItemType||(ItemType={}));var ShootingUserController=function(){function e(){this.bulletView=new ShootingBulletController,this.userImage=new ShootingCharacter(DataCenter.instance.user),this.userImage.x=this.userImage.halfWidth,this.userImage.y=800*GameShootingView.instance.adaptScaleY,this.tempImage=new ShootingCharacter(DataCenter.instance.user,!0),this.tempImage.x=this.userImage.x+App.GameWidth,this.tempImage.y=this.userImage.y,this.tempImage.name="temp",GameShootingView.instance.basicLayer.addChild(this.userImage),GameShootingView.instance.basicLayer.addChild(this.tempImage),this.walk=walkType.stand,this.initRectAndPoint(),App.TimerManager.doFrame(1,0,this.frame,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this)}return e.prototype.initRectAndPoint=function(){this.userImagePoint=new egret.Point,this.tempImagePoint=new egret.Point,this.userImage.localToGlobal(0,0,this.userImagePoint),this.tempImage.localToGlobal(0,0,this.tempImagePoint),this.setRect()},e.prototype.setRect=function(){this.userImage.setRect(this.userImagePoint.x-this.userImage.halfWidth,this.userImagePoint.y-this.userImage.halfHeight,this.userImage.width,this.userImage.height),this.tempImage.setRect(this.tempImagePoint.x-this.tempImage.halfWidth,this.tempImagePoint.y-this.tempImage.halfHeight,this.tempImage.width,this.tempImage.height)},e.prototype.nextRound=function(){this.userImage.x=this.userImage.halfWidth,this.userImage.y=800*GameShootingView.instance.adaptScaleY,this.tempImage.x=this.userImage.x+App.GameWidth,this.tempImage.y=this.userImage.y,this.initRectAndPoint(),this.walk=walkType.stand,this.bulletView.nextRound(),this.userImage.nextRound()},e.prototype.setShield=function(){var e=GameShootingView.instance.shootingGame;e.isWuDi||GameShootingView.instance.controlLayer.shield>0&&(e.isOffLine?this.setSelfShield():App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"shield",1))},e.prototype.onGameEvent=function(e){if(e.userId==DataCenter.instance.user.id){var t=function(e){var t=e.split("|");return t},i=t(e.event);switch(i[0]){case"fire":this.setSelfFire();break;case"shield":this.setSelfShield()}}},e.prototype.setSelfFire=function(){var e=ShootingBullet.createShootingBullet(this.userImage.paoPosition.x,this.userImage.paoPosition.y-100*GameShootingView.instance.adaptScaleY,0);e.init("self",DirectionType.up),this.userImage.fire(),this.bulletView.fire(),App.SoundManager.playEffect("fire_mp3",!0),this.bulletView.bulletLimit<=0&&this.bulletView.reload()},e.prototype.setSelfShield=function(){var e=ShootingGetUID.getUID(),t=new ShootingShield("self",e);App.SoundManager.playEffect("shootingSetWall_mp3",!0),t.x=this.userImage.x+10,t.y=this.userImage.y-150*GameShootingView.instance.adaptScaleY,t.setRect(t.x,t.y),GameShootingView.instance.selfShields.addChild(t),GameShootingView.instance.shootingGame.shields[e]=t,GameShootingView.instance.controlLayer.shield--},Object.defineProperty(e.prototype,"walk",{set:function(e){this._walk!=e&&(this._walk=e,this._walk==walkType.stand?(GameShootingView.instance.shootingGame.isOffLine||App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,walkType[this._walk].toString()+"|"+this.userImage.name+"|"+this.userImage.x),this.tempImage.stand(),this.userImage.stand()):(GameShootingView.instance.shootingGame.isOffLine||App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,walkType[this._walk].toString()),this._walk==walkType.left?(this.tempImage.walkLeft(),this.userImage.walkLeft()):(this.tempImage.walkRight(),this.userImage.walkRight())))},enumerable:!0,configurable:!0}),e.prototype.startFire=function(){GameShootingView.instance.shootingGame.isWuDi||(this.continueFire(),App.TimerManager.doTimer(250,0,this.continueFire,this))},e.prototype.stopFire=function(){App.TimerManager.remove(this.continueFire,this)},e.prototype.continueFire=function(){return this.bulletView.bulletLimit<=0?(this.bulletView.cannotFire(),void this.stopFire()):void(GameShootingView.instance.shootingGame.isOffLine?this.setSelfFire():App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"fire",1))},e.prototype.frame=function(e){if(!GameShootingView.instance.shootingGame.isWuDi){var t=UserConfig.walkSpeed*e/UserConfig.frameTime;switch(this._walk){case walkType.left:this.setUserImageX(-t);break;case walkType.right:this.setUserImageX(t);break;case walkType.stand:}}},e.prototype.setUserImageX=function(e){if(this.userImage.x+=e,this.tempImage.x+=e,this.userImagePoint.x+=e,this.tempImagePoint.x+=e,this.userImage.x<0&&this.userImage.x>-this.userImage.halfWidth){var t=this.tempImage;this.tempImage=this.userImage,this.userImage=t,this.swapPoints()}if(this.tempImage.x<-(App.GameWidth>>1)&&(this.tempImage.x=this.userImage.x+App.GameWidth,this.tempImage.localToGlobal(0,0,this.tempImagePoint)),this.userImage.x>App.GameWidth&&this.userImage.x-App.GameWidth<this.userImage.halfWidth){var t=this.tempImage;this.tempImage=this.userImage,this.userImage=t,this.swapPoints()}this.tempImage.x>3*(App.GameWidth>>1)&&(this.tempImage.x=this.userImage.x-App.GameWidth,this.tempImage.localToGlobal(0,0,this.tempImagePoint)),this.setRect()},e.prototype.swapPoints=function(){var e=this.userImagePoint.x;this.userImagePoint.x=this.tempImagePoint.x,this.tempImagePoint.x=e;var t=this.userImagePoint.y;this.userImagePoint.y=this.tempImagePoint.y,this.tempImagePoint.y=t},e.prototype.dispose=function(){this.stopFire(),App.TimerManager.remove(this.frame,this),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),this.bulletView.dispose()},e}();__reflect(ShootingUserController.prototype,"ShootingUserController");var ShootingBulletController=function(e){function t(){var t=e.call(this)||this;t.bulletlist=[],t.stopBulletFlicker=function(){t.cancelFlickerAndInterval(),t.alpha=1,t.recover()},t.bulletReloadBar=new BulletReloadBar,t.addChild(t.bulletReloadBar),t.bullets=new egret.DisplayObjectContainer,t.addChild(t.bullets);for(var i=0,o=0;o<UserConfig.bulletLimit;o++){var s=AssetManager.getBitmap("bullet1_png");s.scaleX=s.scaleY=.7,i+=40,s.x=i,t.bullets.addChild(s),t.bulletlist.push(s)}return t.index=UserConfig.bulletLimit-1,t.bulletLimit=UserConfig.bulletLimit,t.x=240,t.y=840*GameShootingView.instance.adaptScaleY,GameShootingView.instance.basicLayer.addChildAt(t,10),t}return __extends(t,e),t.prototype.fire=function(){this.index>=0&&this.index<UserConfig.bulletLimit&&(this.bulletlist[this.index].alpha=.3,this.index--,this.bulletLimit--)},t.prototype.cannotFire=function(){this.bulletReloadBar.flip()},t.prototype.reload=function(){this.bulletFicker||(this.bulletFickerEffect||(this.bulletFickerEffect=new EffectUtils),this.bulletFickerEffect.startFlicker(this.bullets,500),this.bulletFicker=setInterval(this.stopBulletFlicker,UserConfig.reloadBullet))},t.prototype.recover=function(){for(var e=0,t=this.bulletlist;e<t.length;e++){var i=t[e];i.alpha=1}this.index=UserConfig.bulletLimit-1,this.bulletLimit=UserConfig.bulletLimit},t.prototype.cancelFlickerAndInterval=function(){this.bulletFicker&&(this.bulletFickerEffect.stopFlicker(this.bullets),clearInterval(this.bulletFicker),this.bulletFicker=void 0)},t.prototype.nextRound=function(){this.recover(),this.cancelFlickerAndInterval(),this.bulletReloadBar.nextRound()},t.prototype.dispose=function(){for(var e=0,t=this.bulletlist;e<t.length;e++){var i=t[e];this.bullets.removeChild(i)}this.bulletlist=[],this.cancelFlickerAndInterval(),this.bulletReloadBar.dispose()},t}(egret.DisplayObjectContainer);__reflect(ShootingBulletController.prototype,"ShootingBulletController");var BulletReloadBar=function(e){function t(){var t=e.call(this)||this;return t.bar=AssetManager.getBitmap("bulletReloadOver_png",!1,!0),t.addChild(t.bar),t.process=AssetManager.getBitmap("bulletReload_png",!1,!0),t.addChild(t.process),t.process.alpha=0,t.barBorder=AssetManager.getBitmap("bulletBorderFlip_png",!1,!0),t.addChildAt(t.barBorder,5),t.barBorder.alpha=0,t.barMask=AssetManager.getBitmap("bulletReloadMask_png",!1,!0),t.addChildAt(t.barMask,6),t}return __extends(t,e),t.prototype.reload=function(){var e=this;this.process.alpha=1;var t=this.process.width;this.process.width=1,egret.Tween.get(this.process).to({width:t},UserConfig.reloadBullet).call(function(){e.process.alpha=0})},t.prototype.flip=function(){egret.Tween.get(this.barBorder).to({alpha:1},200).to({alpha:0},100).to({alpha:1},200).to({alpha:0},100)},t.prototype.nextRound=function(){egret.Tween.removeTweens(this.barBorder)},t.prototype.dispose=function(){egret.Tween.removeTweens(this.barBorder)},t}(egret.DisplayObjectContainer);__reflect(BulletReloadBar.prototype,"BulletReloadBar");var ShootingComController=function(){function e(){var e=this;this.setCompetitorShield=function(){var t=ShootingGetUID.getUID();App.SoundManager.playEffect("shootingSetWall_mp3",!0);var i=new ShootingShield("competitor",t);i.x=e.userImage.x+10,i.y=e.userImage.y+150*GameShootingView.instance.adaptScaleY,i.rotation=180,i.setRect(i.x,i.y),GameShootingView.instance.competitorshields.addChild(i),GameShootingView.instance.shootingGame.shields[t]=i},this.walk=walkType.stand,this.userImage=new ShootingCharacter(DataCenter.instance.room.player),this.userImage.x=App.GameWidth-this.userImage.halfWidth,this.userImage.y=100*GameShootingView.instance.adaptScaleY,this.userImage.rotation=180,this.tempImage=new ShootingCharacter(DataCenter.instance.room.player,!0),this.tempImage.x=this.userImage.x-App.GameWidth,this.tempImage.y=this.userImage.y,this.tempImage.rotation=180,this.tempImage.name="temp",GameShootingView.instance.basicLayer.addChild(this.userImage),GameShootingView.instance.basicLayer.addChild(this.tempImage),this.initRectAndPoint(),App.TimerManager.doFrame(1,0,this.frame,this),GameShootingView.instance.shootingGame.isOffLine||App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this)}return e.prototype.initRectAndPoint=function(){this.userImagePoint=new egret.Point,this.tempImagePoint=new egret.Point,this.userImage.localToGlobal(0,0,this.userImagePoint),this.tempImage.localToGlobal(0,0,this.tempImagePoint),this.setRect()},e.prototype.setRect=function(){this.userImage.setRect(this.userImagePoint.x-this.userImage.halfWidth,this.userImagePoint.y-this.userImage.halfHeight,this.userImage.width,this.userImage.height),this.tempImage.setRect(this.tempImagePoint.x-this.tempImage.halfWidth,this.tempImagePoint.y-this.tempImage.halfHeight,this.tempImage.width,this.tempImage.height)},e.prototype.nextRound=function(){this.userImage.x=App.GameWidth-this.userImage.halfWidth,this.userImage.y=100*GameShootingView.instance.adaptScaleY,this.tempImage.x=this.userImage.x-App.GameWidth,this.tempImage.y=this.userImage.y,this.targetX=void 0,this.initRectAndPoint(),this.userImage.nextRound()},e.prototype.onGameEvent=function(e){if(e.userId!=DataCenter.instance.user.id){var t=function(e){var t=e.split("|");return t},i=t(e.event);switch(i[0]){case"right":console.log("对手向左走了"),this.walk=walkType.left,this.tempImage.walkLeft(),this.userImage.walkLeft();break;case"left":console.log("对手向右走了"),this.walk=walkType.right,this.tempImage.walkRight(),this.userImage.walkRight();break;case"stand":console.log("对手不动了"),this.walk=walkType.stand;var o=i[1];if(o!=this.userImage.name){var s=this.tempImage;this.tempImage=this.userImage,this.userImage=s}this.targetX=App.GameWidth-parseInt(i[2]),this.tempImage.stop(),this.userImage.stop(),this.tempImage.stand(),this.userImage.stand();break;case"fire":console.log("对手开枪了"),this.setCompetitorFire();break;case"shield":console.log("对手放盾牌了"),this.setCompetitorShield()}}},e.prototype.frame=function(e){if(!GameShootingView.instance.shootingGame.isWuDi){var t=UserConfig.walkSpeed*e/UserConfig.frameTime;switch(this.walk){case walkType.left:this.setUserImageX(-t);break;case walkType.right:this.setUserImageX(t);break;case walkType.stand:if(!this.targetX)return;if(this.targetX-this.userImage.x<UserConfig.walkSpeed&&this.targetX-this.userImage.x>-UserConfig.walkSpeed)return this.userImage.x=this.targetX,this.targetX+App.GameWidth>App.GameWidth&&this.targetX+App.GameWidth<3*(App.GameWidth>>1)?this.tempImage.x=this.targetX+App.GameWidth:this.tempImage.x=this.targetX-App.GameWidth,void(this.targetX=void 0);t=UserConfig.walkSpeed*e/UserConfig.frameTime,this.targetX-this.userImage.x>0&&this.setUserImageX(t,!1),this.targetX-this.userImage.x<0&&this.setUserImageX(-t,!1)}}},e.prototype.setCompetitorFire=function(){var e=ShootingBullet.createShootingBullet(this.userImage.paoPosition.x,this.userImage.paoPosition.y+100*GameShootingView.instance.adaptScaleY,0);e.init("competitor",DirectionType.down),this.userImage.fire(),App.SoundManager.playEffect("fire_mp3",!0)},e.prototype.setUserImageX=function(e,t){if(void 0===t&&(t=!0),this.userImage.x+=e,this.tempImage.x+=e,this.userImagePoint.x+=e,this.tempImagePoint.x+=e,t){if(this.userImage.x<0&&this.userImage.x>-this.userImage.halfWidth){var i=this.tempImage;this.tempImage=this.userImage,this.userImage=i,this.swapPoints()}if(this.userImage.x>App.GameWidth&&this.userImage.x-App.GameWidth<this.userImage.halfWidth){var i=this.tempImage;this.tempImage=this.userImage,this.userImage=i,this.swapPoints()}}this.tempImage.x<-(App.GameWidth>>1)&&(this.tempImage.x=this.userImage.x+App.GameWidth,this.tempImage.localToGlobal(0,0,this.tempImagePoint)),this.tempImage.x>3*(App.GameWidth>>1)&&(this.tempImage.x=this.userImage.x-App.GameWidth,this.tempImage.localToGlobal(0,0,this.tempImagePoint)),this.setRect()},e.prototype.swapPoints=function(){var e=this.userImagePoint.x;this.userImagePoint.x=this.tempImagePoint.x,this.tempImagePoint.x=e;var t=this.userImagePoint.y;this.userImagePoint.y=this.tempImagePoint.y,this.tempImagePoint.y=t},e.prototype.dispose=function(){App.TimerManager.remove(this.frame,this),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this)},e}();__reflect(ShootingComController.prototype,"ShootingComController");var GameShootingAI=function(){function e(t){var i=this;this.stop=function(){App.TimerManager.remove(i.aiControl,i)},this.play=function(){App.TimerManager.doTimer(UserConfig.AITime,0,i.aiControl,i)},this.competitorController=t,e.shieldLimit=UserConfig.shieldLimit,e.bulleteLimit=UserConfig.bulletLimit}return e.prototype.aiControl=function(){if(!GameShootingView.instance.shootingGame.isWuDi){e.bulleteLimit<=0&&!e.isReload&&(App.TimerManager.doTimer(UserConfig.reloadBullet,1,function(){e.bulleteLimit=UserConfig.bulletLimit,e.isReload=!1},this),e.isReload=!0);var t=Math.random();return.6>t&&e.bulleteLimit>0&&(this.competitorController.setCompetitorFire(),e.bulleteLimit--),.5>t&&e.shieldLimit>0&&(this.competitorController.setCompetitorShield(),e.shieldLimit--),.3>t?void(this.competitorController.walk=walkType.right):.6>t?void(this.competitorController.walk=walkType.left):.9>t?void(this.competitorController.walk=walkType.stand):void 0}},e.addAIItem=function(){var e,t,i=Math.random();if(.2>i)e=ObjectPool.pop(ShootingRocket,"ShootingRocket"),t=ShootingItemDirectionType.left;else if(.4>i)e=ObjectPool.pop(ShootingRocket,"ShootingRocket"),t=ShootingItemDirectionType.right;else if(.6>i)e=ObjectPool.pop(ShootingSplit,"ShootingSplit"),t=ShootingItemDirectionType.right;else{if(!(.8>i))return;e=ObjectPool.pop(ShootingSplit,"ShootingSplit"),t=ShootingItemDirectionType.left}e.init(t)},e.prototype.dipose=function(){this.stop()},e.isReload=!1,e}();__reflect(GameShootingAI.prototype,"GameShootingAI");var ShootingItemController=function(){function e(){this.isMain=!1,this.isMain=DataCenter.instance.room.selfIsMaster,App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.webListener,this)}return e.prototype.play=function(){GameShootingView.instance.shootingGame.isOffLine?App.TimerManager.doTimer(UserConfig.ItemTime,0,GameShootingAI.addAIItem,GameShootingAI):this.isMain&&App.TimerManager.doTimer(UserConfig.ItemTime,0,this.addItem,this)},e.prototype.stop=function(){GameShootingView.instance.shootingGame.isOffLine?App.TimerManager.remove(GameShootingAI.addAIItem,GameShootingAI):this.isMain&&App.TimerManager.remove(this.addItem,this)},e.prototype.addItem=function(){var e=Math.random();return.2>e?void App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,DataCenter.instance.user.id+"|rocket|left",1):.4>e?void App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,DataCenter.instance.user.id+"|rocket|right",1):.6>e?void App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,DataCenter.instance.user.id+"|split|right",1):.8>e?void App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,DataCenter.instance.user.id+"|split|left",1):void 0},e.prototype.webListener=function(e){var t,i,o=function(e){var t=e.split("|");return t},s=o(e.event);switch(i=s[0]==DataCenter.instance.user.id.toString()?ShootingItemDirectionType[s[2]]:0==ShootingItemDirectionType[s[2]]?1:0,s[1]){case"rocket":t=ObjectPool.pop(ShootingRocket,"ShootingRocket");break;case"split":t=ObjectPool.pop(ShootingSplit,"ShootingSplit");break;default:return}t.init(i)},e.prototype.dispose=function(){this.stop(),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.webListener,this)},e}();__reflect(ShootingItemController.prototype,"ShootingItemController");var ShootingScoreController=function(){function e(){this.userHPs=[],this.competitorHPs=[],this.selfHPContainer=new egret.DisplayObjectContainer,this.competitorContainer=new egret.DisplayObjectContainer,this.userScore=0,this.competitorScore=0;for(var e=0,t=0;t<UserConfig.scores;t++){var i=AssetManager.getQuickDBArmature("HP");e+=50,i.y=e,this.selfHPContainer.addChild(i);var o={isDestroy:!1,hp:i};this.userHPs.push(o)}e=0;for(var t=0;t<UserConfig.scores;t++){var i=AssetManager.getQuickDBArmature("HP");i.rotation=180,e+=50,i.y=e,this.competitorContainer.addChild(i);var s={isDestroy:!1,hp:i};this.competitorHPs.push(s)}this.userIndex=UserConfig.scores-1,this.competitorIndex=UserConfig.scores-1,this.selfHPContainer.y=500*GameShootingView.instance.adaptScaleY,this.selfHPContainer.x=30,GameShootingView.instance.controlLayer.addChild(this.selfHPContainer),this.competitorContainer.y=200*GameShootingView.instance.adaptScaleY,this.competitorContainer.x=App.GameWidth-30,GameShootingView.instance.controlLayer.addChild(this.competitorContainer)}return e.prototype.win=function(e){this.competitorHPs[this.competitorIndex]&&(this.userScore++,this.competitorHPs[this.competitorIndex].isDestroy=!0,this.competitorHPs[this.competitorIndex].hp.play("destroy",1),this.competitorIndex--,this.userScore>=UserConfig.scores?(e(!1),GameShootingView.instance.resultWin(),this.sendmessage(3)):e(!0))},e.prototype.lose=function(e){this.userHPs[this.userIndex]&&(this.competitorScore++,this.userHPs[this.userIndex].isDestroy=!0,this.userHPs[this.userIndex].hp.play("destroy",1),this.userIndex--,this.competitorScore>=UserConfig.scores?(e(!1),GameShootingView.instance.resultlose(),this.sendmessage(1)):e(!0))},e.prototype.sendmessage=function(e){App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,e)},e.prototype.setUserScore=function(e){if(e!=this.userScore&&e>=0&&e<=UserConfig.scores){for(var t=1;e>=t;t++)this.competitorHPs[UserConfig.scores-t].isDestroy||(this.competitorHPs[UserConfig.scores-t].isDestroy=!0,this.competitorHPs[UserConfig.scores-t].hp.play("destroy",1));for(t++,this.userIndex=UserConfig.scores-t;t<=UserConfig.scores;t++)this.competitorHPs[UserConfig.scores-t].isDestroy=!1,this.competitorHPs[UserConfig.scores-t].hp.play("normal",1);this.userScore=e}},e.prototype.setCompetitorScore=function(e){if(e!=this.competitorScore&&e>0&&e<UserConfig.scores){for(var t=1;e>=t;t++)this.userHPs[UserConfig.scores-t].isDestroy||(this.userHPs[UserConfig.scores-t].isDestroy=!0,this.userHPs[UserConfig.scores-t].hp.play("destroy",1));for(t++,this.competitorIndex=UserConfig.scores-t;t<=UserConfig.scores;t++)this.userHPs[UserConfig.scores-t].isDestroy=!1,this.userHPs[UserConfig.scores-t].hp.play("normal",1);this.competitorScore=e}},e.prototype.dispose=function(){for(var e=0,t=this.userHPs;e<t.length;e++){var i=t[e];i.isDestroy=!1,i.hp.parent.removeChild(i.hp)}for(var o=0,s=this.competitorHPs;o<s.length;o++){var i=s[o];i.isDestroy=!1,i.hp.parent.removeChild(i.hp)}this.userHPs=[],this.competitorHPs=[],this.userScore=0,this.competitorScore=0,this.userIndex=0,this.competitorIndex=0},e}();__reflect(ShootingScoreController.prototype,"ShootingScoreController");var GameShooting=function(){function e(){var e=this;this.items=[],this.isOffLine=!1,this.isWuDi=!0,this.shields={},this.bullets=[],this.pauseCallback=function(){App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,1),GameShootingView.instance.next("gameChangeMatch")},this.startTime=function(){e.itemController.play(),e.isWuDi=!1,e.isOffLine&&(GameShootingAI.shieldLimit=UserConfig.shieldLimit,GameShootingAI.bulleteLimit=UserConfig.bulletLimit,e.delayAi=setTimeout(function(){e.ai.play(),clearTimeout(e.delayAi),e.delayAi=void 0},100))},this.onGameResult=function(t){DataCenter.instance.room.gameResult=t;var i=function(){t.winUserId==DataCenter.instance.user.id?GameShootingView.instance.resultWin():GameShootingView.instance.resultlose(),setTimeout(function(){DataCenter.instance.room.gameResult=t,GameShootingView.instance.popup("GameResult"),e.dispose()},3e3)};DataCenter.instance.room.gameResult=t,GameShootingView.instance.popup("GameResult",i)},this.isWuDi=!0,DataCenter.instance.room.IsAI&&(this.isOffLine=!0),this.userID=DataCenter.instance.user.id.toString()}return e.prototype.initObjects=function(){for(var e=[],t=0;t<UserConfig.bulletLimit;t++)e.push(ShootingBullet.popShootingBullet());for(;e.length;)ObjectPool.push(e.pop());for(var i=0;5>i;i++)e.push(ShootingBullet.popShootingBullet_rocket()),e.push(ObjectPool.pop(ShootingRocket,"ShootingRocket")),e.push(ObjectPool.pop(ShootingSplit,"ShootingSplit"));for(;e.length;)ObjectPool.push(e.pop())},e.prototype.init=function(){this.initObjects(),this.competitorController=new ShootingComController,this.itemController=new ShootingItemController,this.userController=new ShootingUserController,this.scoreController=new ShootingScoreController,this.isOffLine&&(this.ai=new GameShootingAI(this.competitorController)),App.MessageCenter.addListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.addListener(EventMessage.pauseMessage,this.pauseCallback,this),this.initBgMusic()},e.prototype.onGameEvent=function(e){var t=function(e){var t=e.split("|");
return t},i=t(e.event);switch(i[0]){case"nextRound":i[1]==this.userID?(this.scoreController.setUserScore(parseInt(i[2])),this.scoreController.setCompetitorScore(parseInt(i[3]))):(this.scoreController.setCompetitorScore(parseInt(i[2])),this.scoreController.setUserScore(parseInt(i[3]))),this.nextRound();break;case"shieldDestroy":this.shields[i[1]]&&this.shields[i[1]].destroy()}},e.prototype.nextRound=function(){this.competitorController.nextRound(),this.userController.nextRound(),this.clearGameItems(),GameShootingView.instance.controlLayer.shield=UserConfig.shieldLimit,egret.Tween.get(GameShootingView.instance.roundBG).to({alpha:0},100).call(function(){GameShootingView.instance.timeImg.play()})},e.prototype.stopThisRound=function(e){var t=this;this.itemController.stop(),this.isOffLine&&this.ai.stop(),e?this.stopthisRoundNumber=setTimeout(function(){egret.Tween.get(GameShootingView.instance.roundBG).to({alpha:.9},100).call(function(){t.clearGameItems(),e()}),clearTimeout(t.stopthisRoundNumber),t.stopthisRoundNumber=void 0},200):this.clearGameItems()},e.prototype.initBgMusic=function(){App.SoundManager.playBg("ShootingBgMusic_mp3")},e.prototype.clearGameItems=function(){for(;this.bullets.length;){var e=this.bullets[0];e.destroy()}for(var t in this.shields){var i=this.shields[t];i.destroy()}for(this.shields={};this.items.length;){var o=this.items[0];o.destroy()}},e.prototype.dispose=function(){App.MessageCenter.removeListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.removeListener(EventMessage.pauseMessage,this.pauseCallback,this),this.clearGameItems(),this.userController.dispose(),this.itemController.dispose(),this.competitorController.dispose(),this.scoreController.dispose(),this.delayAi&&(clearTimeout(this.delayAi),this.delayAi=void 0),this.stopthisRoundNumber&&(clearTimeout(this.stopthisRoundNumber),this.stopthisRoundNumber=void 0),this.isOffLine&&this.ai.dipose(),ObjectPool.clearClass("ShootingBullet"),ObjectPool.clearClass("ShootingBullet_rocket"),ObjectPool.clearClass("ShootingSplit"),ObjectPool.clearClass("ShootingRocket")},e.point=new egret.Point,e}();__reflect(GameShooting.prototype,"GameShooting");var DirectionType;!function(e){e[e.up=0]="up",e[e.down=1]="down"}(DirectionType||(DirectionType={}));var BulletType;!function(e){e[e.common=0]="common",e[e.rocket=1]="rocket"}(BulletType||(BulletType={}));var ShootingBullet=function(e){function t(t){var i=e.call(this)||this;return i.isDestroy=!1,i.init=function(e,t,o){i.isDestroy=!1,i._owner=e,i.direction=t,o?i.type=o:i.type=BulletType.common,App.TimerManager.doFrame(5/GameShootingView.instance.adaptScaleY,0,i.collisonFrame,i),App.TimerManager.doFrame(1,0,i.transformFrame,i)},i.destroy=function(e){void 0===e&&(e=!1),i.isDestroy=!0,App.TimerManager.remove(i.collisonFrame,i),App.TimerManager.remove(i.transformFrame,i),i.delayNextRound&&(clearTimeout(i.delayNextRound),i.delayNextRound=void 0),e?(i.direction==DirectionType.up?(i.baozha.rotation=180,i.baozha.y=-50):i.baozha.y=50,i.baozha.play("baozha",1),i.baozha.addDisplayEvent(dragonBones.EventObject.COMPLETE,i.baozhaOver,i),App.DisplayUtils.quickAddChild(i,i.baozha)):i.removeFromParent()},i.baozhaOver=function(){i.removeFromParent()},i.collisonFrame=function(e){i.isDestroy||(i.rect_bullet.x=i.globalPoint.x-i.halfWidth,i.rect_bullet.y=i.globalPoint.y-i.halfHeight,i.collisonShields()||i.collisonItems()||i.collisonUser())},i.transformFrame=function(e){if(!i.isDestroy){var t=i.moveSpeed_x*e*GameShootingView.instance.adaptScaleY,o=i.moveSpeed_y*e*GameShootingView.instance.adaptScaleY;switch(i.direction){case DirectionType.down:if(i.y+=o,i.x-=t,i.globalPoint.x-=t,i.globalPoint.y+=o,i.globalPoint.y>760/1136*App.GameHeight)return void i.destroy(!0);break;case DirectionType.up:if(i.y-=o,i.x+=t,i.globalPoint.x+=t,i.globalPoint.y-=o,i.globalPoint.y<150/1136*App.GameHeight)return void i.destroy(!0)}}},i.stopRoundAndNext=function(){var e=GameShootingView.instance.shootingGame;e.stopThisRound(function(){GameShootingView.instance.shootingGame.isOffLine?i.delayNextRound=setTimeout(function(){e.nextRound(),clearTimeout(i.delayNextRound),i.delayNextRound=void 0},100):App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"nextRound|"+e.userID+"|"+e.scoreController.userScore+"|"+e.scoreController.competitorScore,1)})},i.stopRound=function(){var e=GameShootingView.instance.shootingGame;e.stopThisRound()},i.rect_bullet=new egret.Rectangle,i.globalPoint=new egret.Point,i.bullet_img=AssetManager.getBitmap(t),App.DisplayUtils.quickAddChild(i,i.bullet_img),i.width=i.width,i.height=i.height,i.halfWidth=i.width>>1,i.halfHeight=i.height>>1,i.baozha=AssetManager.getQuickDBArmature("game2_pao"),i}return __extends(t,e),Object.defineProperty(t.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),t.prototype.collisonShields=function(){var e=GameShootingView.instance.shootingGame;for(var t in e.shields){var i=e.shields[t];if(i.owner!=this.owner&&App.RectangleUtils.intersects(this.rect_bullet,i.getRect()))return this.type==BulletType.rocket?(e.isOffLine?i.destroy():App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"shieldDestroy|"+i.uid,1),!0):(i.hit(),this.destroy(!0),!0)}return!1},t.prototype.collisonItems=function(){for(var e=GameShootingView.instance.shootingGame,t=0,i=e.items;t<i.length;t++){var o=i[t];if(App.RectangleUtils.intersects(this.rect_bullet,o.getRect()))return o.effect(this),!0}return!1},t.prototype.collisonUser=function(){var e=this,t=GameShootingView.instance.shootingGame,i="competitor"==this.owner?t.userController.userImage:t.competitorController.userImage;if(App.RectangleUtils.intersects(this.rect_bullet,i.getRect())&&!t.isWuDi){t.isWuDi=!0,this.destroy(!0);var o=function(t){var o="competitor"==e.owner?"boom_self_mp3":"boom_competitor_mp3";App.SoundManager.playEffect(o,!0),i.stop(),t?i.lose(e.stopRoundAndNext):i.lose(e.stopRound)};return"competitor"==this.owner?t.scoreController.lose(o):t.scoreController.win(o),!0}return!1},t.prototype.removeFromParent=function(){this.baozha.stop(),this.baozha.removeDisplayEvent(dragonBones.EventObject.COMPLETE,this.baozhaOver,this),App.DisplayUtils.quickRemoveChild(this.baozha),App.DisplayUtils.quickRemoveChild(this);var e=GameShootingView.instance.shootingGame.bullets.indexOf(this);GameShootingView.instance.shootingGame.bullets.splice(e,1),ObjectPool.push(this)},t.prototype.setRotation=function(e){this.rotation=e,this.moveSpeed_x=UserConfig.bulletSpeed*Math.sin(e/180*Math.PI)/UserConfig.frameTime,this.moveSpeed_y=UserConfig.bulletSpeed*Math.cos(e/180*Math.PI)/UserConfig.frameTime},t.createShootingBulletInit=function(e,t,i,o){e.x=t,e.y=i,e.setRotation(o),App.DisplayUtils.quickAddChild(GameShootingView.instance.bulletsLayer,e),GameShootingView.instance.shootingGame.bullets.push(e),e.localToGlobal(0,0,e.globalPoint),e.rect_bullet.setTo(e.globalPoint.x-e.halfWidth,e.globalPoint.y-e.halfHeight,e.width,e.height)},t.popShootingBullet=function(){return ObjectPool.pop(t,"ShootingBullet","bullet1_png")},t.popShootingBullet_rocket=function(){return ObjectPool.pop(t,"ShootingBullet_rocket","rocket_png")},t.createShootingBullet=function(e,t,i){var o=this.popShootingBullet();return this.createShootingBulletInit(o,e,t,i),o},t.createShootingBullet_rocket=function(e,t,i){var o=this.popShootingBullet_rocket();return this.createShootingBulletInit(o,e,t,i),o},t.createShootingBulletByBullet=function(e,t){var i=this.createShootingBullet(e.x,e.y,t);return i.init(e.owner,e.direction),i},t.createShootingBullet_rocketByBullet=function(e,t){var i=this.createShootingBullet_rocket(e.x,e.y,t);return i.init(e.owner,e.direction,BulletType.rocket),i},t}(egret.DisplayObjectContainer);__reflect(ShootingBullet.prototype,"ShootingBullet");var ShootingCharacter=function(e){function t(t,i,o){void 0===i&&(i=!1),void 0===o&&(o="game2_pao");var s=e.call(this)||this;return s.istemp=!1,s.userImage=AssetManager.getQuickDBArmature(o),s.userImage.x=30,s.istemp=i,s.personImg=new RoleAvatar(t.curAvatarType,t.imgUrl).armature,s.personImg.scaleX=.8,s.personImg.scaleY=.8,s.personImg.play("home"),s.addChild(s.personImg),s.addChild(s.userImage),s.width=s.width,s.height=s.height,s.halfWidth=s.width>>1,s.halfHeight=s.height>>1,s._rect=new egret.Rectangle,s._paoPosition=new egret.Point,s}return __extends(t,e),t.prototype.setRect=function(e,t,i,o){this._rect.x=e,this._rect.y=t,this._rect.width=i,this._rect.height=o},t.prototype.getRect=function(){return this._rect},Object.defineProperty(t.prototype,"paoPosition",{get:function(){return this.localToGlobal(this.userImage.x,this.userImage.y,this._paoPosition),this._paoPosition},enumerable:!0,configurable:!0}),t.prototype.walkLeft=function(){this.userImage.play("zuo")},t.prototype.walkRight=function(){this.userImage.play("you")},t.prototype.stand=function(){this.userImage.stop(),this.userImage.play("wz",1)},t.prototype.lose=function(e){var t=this;if(this.userImage.play("over",1),this.personImg.play("Loser1",1),e){var i=function(){t.userImage.removeDisplayEvent(dragonBones.EventObject.COMPLETE,i,t),e()};this.userImage.addDisplayEvent(dragonBones.EventObject.COMPLETE,i,this)}},t.prototype.nextRound=function(){this.userImage.play("wz",1),this.personImg.play("home")},t.prototype.fire=function(){this.userImage.play("paoshe",1)},t.prototype.stop=function(){this.userImage.stop(),this.personImg.stop()},t}(egret.DisplayObjectContainer);__reflect(ShootingCharacter.prototype,"ShootingCharacter");var ShootingItemDirectionType;!function(e){e[e.left=0]="left",e[e.right=1]="right"}(ShootingItemDirectionType||(ShootingItemDirectionType={}));var ShootingItem=function(e){function t(){var t=e.call(this)||this;return t._isDestroy=!1,t.frame=function(e){if(!t._isDestroy){var i=UserConfig.ItemSpeed*e/UserConfig.frameTime;switch(t._direction){case ShootingItemDirectionType.left:t.x-=i,t._itemPoint.x-=i,t._rect.x-=i;break;case ShootingItemDirectionType.right:t.x+=i,t._itemPoint.x+=i,t._rect.x+=i}(t._itemPoint.x<-300||t._itemPoint.x>App.GameWidth+300)&&t.destroy()}},t._rect=new egret.Rectangle,t._itemPoint=new egret.Point,t}return __extends(t,e),Object.defineProperty(t.prototype,"itemType",{get:function(){return this._itemType},enumerable:!0,configurable:!0}),t.prototype.init=function(e){switch(this._isDestroy=!1,this._direction=e,this._direction){case ShootingItemDirectionType.left:this.x=App.GameWidth+100;break;case ShootingItemDirectionType.right:this.x=-100}this.y=450*GameShootingView.instance.adaptScaleY,App.DisplayUtils.quickAddChild(GameShootingView.instance.bulletsLayer,this),GameShootingView.instance.shootingGame.items.push(this),this.localToGlobal(0,0,this._itemPoint),this._rect.setTo(this._itemPoint.x-(this.width>>1),this._itemPoint.y-(this.height>>1),this.width,this.height),App.TimerManager.doFrame(1,0,this.frame,this)},t.prototype.getRect=function(){return this._rect},t.prototype.destroy=function(){this._isDestroy=!0,App.TimerManager.remove(this.frame,this),App.DisplayUtils.quickRemoveChild(this);var e=GameShootingView.instance.shootingGame.items.indexOf(this);GameShootingView.instance.shootingGame.items.splice(e,1)},t.prototype.effect=function(e){},t}(egret.DisplayObjectContainer);__reflect(ShootingItem.prototype,"ShootingItem",["ShootingItemPort"]);var ShootingRocket=function(e){function t(){var t=e.call(this)||this,i=AssetManager.getBitmap("rocketButton_png");return i.x=i.width>>1,i.y=i.height>>1,App.DisplayUtils.quickAddChild(t,i),t.width=t.width,t.height=t.height,t}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),this._itemType=ItemType.rocket},t.prototype.effect=function(e){this.destroy(),GameShootingView.instance.controlLayer.boomPlay(e.x,e.y),ShootingBullet.createShootingBullet_rocketByBullet(e,e.rotation),App.SoundManager.playEffect("shootinggetItem_mp3",!0)},t}(ShootingItem);__reflect(ShootingRocket.prototype,"ShootingRocket");var ShootingSplit=function(e){function t(){var t=e.call(this)||this,i=AssetManager.getBitmap("splitButton_png");return i.x=i.width>>1,i.y=i.height>>1,App.DisplayUtils.quickAddChild(t,i),t.width=t.width,t.height=t.height,t}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),this._itemType=ItemType.split},t.prototype.effect=function(e){this.destroy(),GameShootingView.instance.controlLayer.boomPlay(e.x,e.y),App.SoundManager.playEffect("shootinggetItem_mp3",!0);var t,i,o;switch(e.type){case BulletType.common:t=ShootingBullet.createShootingBulletByBullet(e,0),i=ShootingBullet.createShootingBulletByBullet(e,45),o=ShootingBullet.createShootingBulletByBullet(e,-45);break;case BulletType.rocket:t=ShootingBullet.createShootingBullet_rocketByBullet(e,0),i=ShootingBullet.createShootingBullet_rocketByBullet(e,45),o=ShootingBullet.createShootingBullet_rocketByBullet(e,-45);break;default:return}},t}(ShootingItem);__reflect(ShootingSplit.prototype,"ShootingSplit");var ShootingShield=function(e){function t(t,i){var o=e.call(this)||this;return o._uid=i,o._owner=t,o.hp=UserConfig.shieldHP,o.shield_img=AssetManager.getBitmap("shield1_png"),o.addChild(o.shield_img),o._rect=new egret.Rectangle,o._rect.width=o.shield_img.width,o._rect.height=o.shield_img.height,o}return __extends(t,e),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),t.prototype.setRect=function(e,t){var i=GameShootingView.instance.localToGlobal(e,t,GameShooting.point);this._rect.x=i.x-(this.shield_img.width>>1),this._rect.y=i.y-(this.shield_img.height>>1)},t.prototype.getRect=function(){return this._rect},Object.defineProperty(t.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),t.prototype.hit=function(){this.parent&&(this.hp--,egret.Tween.get(this).to({scaleY:.8},100).to({scaleY:1},100).to({scaleY:.9},100).to({scaleY:1},100),this.hp<5&&(this.shield_img.texture=RES.getRes("shield2_png")),this.hp<3&&(this.shield_img.texture=RES.getRes("shield3_png")),this.hp<=0&&(GameShootingView.instance.shootingGame.isOffLine?this.destroy():App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,"shieldDestroy|"+this.uid,1)))},t.prototype.destroy=function(){this.parent.removeChild(this);var e=GameShootingView.instance.shootingGame;delete e.shields[this.uid],"self"==this._owner&&GameShootingView.instance.controlLayer.shield++,"competitor"==this._owner&&e.isOffLine&&GameShootingAI.shieldLimit++},t}(egret.DisplayObjectContainer);__reflect(ShootingShield.prototype,"ShootingShield");var ShootingGetUID=function(){function e(){}return e.getUID=function(){return this._UID++,this._UID},e._UID=0,e}();__reflect(ShootingGetUID.prototype,"ShootingGetUID");