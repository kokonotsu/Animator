var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},GameTwiceJoyAI=function(e){function t(t){var a=e.call(this)||this;return a.setTimeoutBool=!1,a.intervalIdRobotAiKey=0,a.setTimeoutIdRobotAiKey=0,a.checkResultScore=function(){a.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore>=GameTwiceJoyModel.resultScore&&(a.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore=GameTwiceJoyModel.resultScore),a.gameTwiceJoyMainView.playerAvatarGroup2.right=a.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore/GameTwiceJoyModel.resultScore*GameTwiceJoyMainView.avatarMoveDistance,a.gameTwiceJoyMainView.blueProgress.width=a.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore/GameTwiceJoyModel.resultScore*GameTwiceJoyMainView.avatarMoveDistance,a.gameTwiceJoyMainView.arriveScore()},a.gameTwiceJoyMainView=t,a}return __extends(t,e),t.prototype.robotAiStart=function(){var e=GameTwiceJoyMainView.aiConf[t.robotAiLv+""];t.robotSec=e.s+Math.random()*e.r,this.hardModel()},t.prototype.aiWin=function(){var e=this;this.intervalIdRobotAiKey=egret.setInterval(function(){var t=e.gameTwiceJoyMainView.gameTwiceJoyModel.myScore,a=e.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore;if(2>=a-t&&t>0)e.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore++,e.checkResultScore();else{if(e.setTimeoutBool)return;e.setTimeoutBool=!0,e.setTimeoutIdRobotAiKey=egret.setTimeout(function(){e.setTimeoutBool=!1,e.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore++,e.checkResultScore()},e,1800+3e3*Math.random())}},this,100)},t.prototype.hardModel=function(){var e=this;this.intervalIdRobotAiKey=egret.setInterval(function(){e.setTimeoutBool||(e.setTimeoutBool=!0,e.setTimeoutIdRobotAiKey=egret.setTimeout(function(){e.setTimeoutBool=!1,e.gameTwiceJoyMainView.gameTwiceJoyModel.otherScore++,e.checkResultScore()},e,t.robotSec))},this,500)},t.prototype.clearData=function(){this.setTimeoutBool=!1,egret.clearInterval(this.intervalIdRobotAiKey),egret.clearTimeout(this.setTimeoutIdRobotAiKey)},t.robotAiLv=3,t.robotSec=0,t}(egret.DisplayObjectContainer);__reflect(GameTwiceJoyAI.prototype,"GameTwiceJoyAI");var GameTwiceJoyCard=function(e){function t(){var t=e.call(this,GameTwiceJoyCardSkin)||this;return t._cardType=0,t._matchingSuccess=!1,t._isOpen=!1,t._cardPosId=0,t._matchingSuccess=!1,t._isOpen=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"cardType",{get:function(){return this._cardType},set:function(e){this._cardType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iconSource",{set:function(e){this._iconSource=e,this.showCardImg&&(this.showCardImg.source=this._iconSource)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._iconSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matchSuccess",{get:function(){return this._matchingSuccess},set:function(e){this._matchingSuccess=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this._isOpen},set:function(e){this._isOpen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardPosId",{get:function(){return this._cardPosId},set:function(e){this._cardPosId=e},enumerable:!0,configurable:!0}),t.prototype.cardOpen=function(){var e=this;e.clearTween(),e.cardBgImg.scaleX=0,e.showCardImg.scaleX=0,e.hideCardImg.scaleX=1,egret.Tween.get(e.hideCardImg).to({scaleX:0},80,egret.Ease.backIn).call(function(){egret.Tween.get(e.cardBgImg).to({scaleX:1},80,egret.Ease.backOut),egret.Tween.get(e.showCardImg).to({scaleX:1},80,egret.Ease.backOut)})},t.prototype.cardClose=function(){var e=this;e.clearTween(),e.cardBgImg.scaleX=1,e.showCardImg.scaleX=1,e.hideCardImg.scaleX=0,egret.Tween.get(e.cardBgImg).to({scaleX:0},80,egret.Ease.backOut),egret.Tween.get(e.showCardImg).to({scaleX:0},80,egret.Ease.backIn).call(function(){egret.Tween.get(e.hideCardImg).to({scaleX:1},80,egret.Ease.backOut)})},t.prototype.cardMatchSuccess=function(){var e=this;e.clearTween(),e.hideCardImg.visible=!1,e.hideCardImg.scaleX=0,e.cardBgImg.scaleX=e.cardBgImg.scaleY=1,e.showCardImg.scaleX=e.showCardImg.scaleY=1,egret.setTimeout(function(){egret.Tween.get(e.cardBgImg).to({scaleX:0,scaleY:0},300,egret.Ease.sineInOut),egret.Tween.get(e.showCardImg).to({scaleX:0,scaleY:0},300,egret.Ease.sineInOut),e.matchSuccessImg.visible=!0,e.matchSuccessImg.scaleX=e.matchSuccessImg.scaleY=1,egret.Tween.get(e.matchSuccessImg).to({scaleX:1.4,scaleY:1.4},100,egret.Ease.sineInOut).call(function(){egret.Tween.get(e.matchSuccessImg).to({scaleX:0,scaleY:0},80,egret.Ease.sineInOut)})},this,400)},t.prototype.clearTween=function(){egret.Tween.removeTweens(this.cardBgImg),egret.Tween.removeTweens(this.showCardImg),egret.Tween.removeTweens(this.hideCardImg),egret.Tween.removeTweens(this.matchSuccessImg)},t}(EuiComponent);__reflect(GameTwiceJoyCard.prototype,"GameTwiceJoyCard");var GameTwiceJoyMainView=function(e){function t(){var t=e.call(this,GameTwiceJoyMainSkin)||this;return t.gameStartBool=!1,t.cardsItemArr=[],t.selectCardArr=[],t.particleManager=function(e,a,r,o,i,s){void 0===i&&(i=""),void 0===s&&(s=.2),t.particleStars1.emitterX=e,t.particleStars1.emitterY=a,t.particleStars1.start(100),t.particleStars2.emitterX=r,t.particleStars2.emitterY=o,t.particleStars2.start(100)},t.gameTwiceJoyModel=new GameTwiceJoyModel,t}return __extends(t,e),t.prototype.init=function(){var a=this;e.prototype.init.call(this);var r=App.GameWidth/t.GAME_WIDTH,o=App.GameHeight/t.GAME_HEIGHT,i=Math.min(r,o);this.containerGroup.scaleX=this.containerGroup.scaleY=i,this.containerGroup.x=.5*(App.GameWidth-t.GAME_WIDTH*i),this.containerGroup.y=.5*(App.GameHeight-t.GAME_HEIGHT*i),App.SoundManager.stopBg(),this.twiceJoyEffect=new SoundEffects,this.twiceJoyEffect.setVolume(1),this.twiceJoyCommonEffect=new SoundEffects,this.twiceJoyCommonEffect.setVolume(1),egret.lifecycle.onPause=function(){a.twiceJoyEffect&&(a.twiceJoyEffect.setVolume(0),App.SoundManager.setBgOn(!1),App.SoundManager.setEffectOn(!1)),a.twiceJoyCommonEffect&&a.twiceJoyCommonEffect.setVolume(0)},egret.lifecycle.onResume=function(){a.twiceJoyEffect&&(a.twiceJoyEffect.setVolume(1),App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!0)),a.twiceJoyCommonEffect&&a.twiceJoyCommonEffect.setVolume(1)},GameTwiceJoyModel.random=new Math.seedrandom(DataCenter.instance.room.id.toString()),this.gameTwiceJoyModel.mapInit();var s=RES.getRes("twice_stars_png"),c=RES.getRes("twice_stars_json");this.particleStars1=new particle.GravityParticleSystem(s,c),this.particleStars2=new particle.GravityParticleSystem(s,c),this.cardEffectGroup.addChild(this.particleStars1),this.cardEffectGroup.addChild(this.particleStars2);for(var n=1;7>n;n++)for(var m=1;5>m;m++){var d=4*(n-1)+m,h=new GameTwiceJoyCard;h.anchorOffsetX=h.anchorOffsetY=67.5,h.x=141*(m-1)+70.5,h.y=141*(n-1)+70.5,h.cardType=this.gameTwiceJoyModel.twiceMapData[d-1],h.iconSource="twiceIcon"+this.gameTwiceJoyModel.twiceMapData[d-1]+"_png",h.cardPosId=d,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameCardItemClickHandle,this),this.cardsItemArr.push({cardType:h.cardType,cardPosId:h.cardPosId,cardItemData:h}),this.cardsGroup.addChild(h)}this.goBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goBackBtnHandler,this),(App.IsXiaoMi||App.IsWanba)&&(this.goBackBtn.visible=!1,this.goBackBtn.touchEnabled=!1);for(var n=1;6>=n;++n)this["btn_express"+n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendExpressMessage,this);this.myHeadImage&&(this.myHeadImage.dispose(),this.myHeadImage=null),this.myHeadImage=new RoleHeadImage(DataCenter.instance.user.imgUrl,"tou_png",60,60),this.otherHeadImage&&(this.otherHeadImage.dispose(),this.otherHeadImage=null),this.otherHeadImage=new RoleHeadImage(DataCenter.instance.room.player.imgUrl,"tou_png",60,60)},t.prototype.show=function(){e.prototype.show.call(this),this.gameStartBool=!1,this.playerAvatarAdd(),DataCenter.instance.room.IsAI&&(this.gameRobotAi=new GameTwiceJoyAI(this),GameTwiceJoyAI.robotAiLv=App.CurrGameAiLevel)},t.prototype.playerAvatarAdd=function(){var e=this,a=DataCenter.instance.user;this.player1NameLab.text=a.name,this.player1SexImg.source=GameCenterGetSexIcon.getSexIconSource(a.sex);var r=DataCenter.instance.room.player;this.player2NameLab.text=r.name,this.player2SexImg.source=GameCenterGetSexIcon.getSexIconSource(r.sex),this.player1Avatar.addChild(this.myHeadImage),this.myHeadImage.x=0,this.myHeadImage.y=0,this.player2Avatar.addChild(this.otherHeadImage),this.otherHeadImage.x=0,this.otherHeadImage.y=0,this.playerAvatarGroup1.left=this.playerAvatarGroup2.right=0,DataCenter.instance.room.IsAI?App.MessageCenter.dispatch(EventMessage.GetDataC2S,function(a){t.aiConf=a,console.log("IsXiaoMi"+App.CurrGameAiLevel+"   "+JSON.stringify(t.aiConf)),e.gameStart()}):this.gameStart()},t.prototype.gameStart=function(){function e(){var e=this;this.readyIMG=new GameReady(function(){App.SoundManager.playBg("twiceJoy_bg_mp3"),e.gameStartBool=!0,DataCenter.instance.room.IsAI&&e.gameRobotAi&&e.gameRobotAi.robotAiStart()}),this.readyIMG.x=300,this.readyIMG.y=App.GameHeight/2,this.addChild(this.readyIMG),this.readyIMG.play()}this.clearTimeoutReadyId=egret.setTimeout(e,this,800)},t.prototype.addMesssgaeListener=function(){e.prototype.addMesssgaeListener.call(this),App.MessageCenter.addListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),App.MessageCenter.addListener(EventMessage.ReceiveGameResultS2C,this.onGameResult,this),App.MessageCenter.addListener(EventMessage.GameLeave,this.onGameleave,this)},t.prototype.onGameEvent=function(e){var a=e.event.split("|");switch(a[0]){case GameTwiceJoyModel.CARD_MATCH_SUCCESS:e.userId==DataCenter.instance.user.id?(this.gameTwiceJoyModel.myScore++,this.playerAvatarGroup1.left=this.gameTwiceJoyModel.myScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.redProgress.width=this.gameTwiceJoyModel.myScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.arriveScore()):(this.gameTwiceJoyModel.otherScore++,this.playerAvatarGroup2.right=this.gameTwiceJoyModel.otherScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.blueProgress.width=this.gameTwiceJoyModel.otherScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.arriveScore());break;case GameTwiceJoyModel.SEND_EXPRESS:this.addQiPaoCartoon(a[1],2)}},t.prototype.arriveScore=function(){return this.gameTwiceJoyModel.myScore>=GameTwiceJoyModel.resultScore?void this.sendResult(3):void(this.gameTwiceJoyModel.otherScore>=GameTwiceJoyModel.resultScore&&this.sendResult(1))},t.prototype.onGameResult=function(e){DataCenter.instance.room.gameResult=e,this.popup("GameResult",null)},t.prototype.onGameleave=function(){this.clearData()},t.prototype.clearData=function(){this.gameStartBool=!1,DataCenter.instance.room.IsAI&&this.gameRobotAi&&this.gameRobotAi.clearData(),egret.clearTimeout(this.clearTimeoutReadyId)},t.prototype.dispose=function(){e.prototype.dispose.call(this),DataCenter.instance.room.IsAI&&this.gameRobotAi&&(this.gameRobotAi.clearData(),this.gameRobotAi=null),this.cardsItemArr.splice(0),this.cardsItemArr=[],this.selectCardArr.splice(0),this.selectCardArr=[],this.gameStartBool=!1,egret.clearTimeout(this.clearTimeoutReadyId),this.cardsGroup.removeChildren(),App.SoundManager.stopBg(),this.twiceJoyEffect.setVolume(0),this.twiceJoyCommonEffect.setVolume(0),this.twiceJoyEffect=null,this.twiceJoyCommonEffect=null},t.prototype.playerAvatarGroup1Handler=function(){this.twiceJoyCommonEffect&&this.twiceJoyCommonEffect.play("mouseClickSound_mp3");var e;e=DataCenter.instance.user,this.popup("GameCenterMyHomePage",{lastViewName:"IS_GAMEING",currPlayerData:e})},t.prototype.playerAvatarGroup2Handler=function(){this.twiceJoyCommonEffect&&this.twiceJoyCommonEffect.play("mouseClickSound_mp3");var e;e=DataCenter.instance.room.player,this.popup("GameCenterMyHomePage",{lastViewName:"IS_GAMEING",currPlayerData:e})},t.prototype.gameCardItemClickHandle=function(e){if(this.gameStartBool){var t=e.currentTarget;t.isOpen||(t.isOpen=!0,this.twiceJoyEffect&&this.twiceJoyEffect.play("twiceJoy_open_mp3"),this.cardMatchCheck(t,t.x,t.y))}},t.prototype.cardMatchCheck=function(e,a,r){if(2==this.selectCardArr.length){for(var o=0;o<this.cardsItemArr.length;o++)this.cardsItemArr[o].cardPosId==this.selectCardArr[0]&&(this.cardsItemArr[o].cardItemData.isOpen=!1,this.cardsItemArr[o].cardItemData.cardClose()),this.cardsItemArr[o].cardPosId==this.selectCardArr[1]&&(this.cardsItemArr[o].cardItemData.isOpen=!1,this.cardsItemArr[o].cardItemData.cardClose());this.selectCardArr.splice(0),this.selectCardArr=[]}if(0==this.selectCardArr.length)this.selectCardArr.push(e.cardPosId),e.cardOpen();else if(1==this.selectCardArr.length){this.gameStartBool=!1,this.selectCardArr.push(e.cardPosId);for(var i,s,o=0;o<this.cardsItemArr.length;o++)this.cardsItemArr[o].cardPosId==this.selectCardArr[0]&&(i=this.cardsItemArr[o].cardItemData),this.cardsItemArr[o].cardPosId==this.selectCardArr[1]&&(s=this.cardsItemArr[o].cardItemData);i.cardType==s.cardType?(this.twiceJoyEffect&&this.twiceJoyEffect.play("twiceJoy_matchSuccess_mp3"),this.particleManager(i.x,i.y,s.x,s.y),this.selectCardArr.splice(0),this.selectCardArr=[],i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.gameCardItemClickHandle,this),s.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.gameCardItemClickHandle,this),i.cardMatchSuccess(),s.cardMatchSuccess(),DataCenter.instance.room.IsAI?(this.gameTwiceJoyModel.myScore++,this.playerAvatarGroup1.left=this.gameTwiceJoyModel.myScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.redProgress.width=this.gameTwiceJoyModel.myScore/GameTwiceJoyModel.resultScore*t.avatarMoveDistance,this.arriveScore()):App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,GameTwiceJoyModel.CARD_MATCH_SUCCESS,1)):(this.twiceJoyEffect&&this.twiceJoyEffect.play("twiceJoy_matchFailed_mp3"),e.cardOpen()),this.gameStartBool=!0}},t.prototype.addQiPaoCartoon=function(e,t){void 0===t&&(t=1);var a=new QIPaoCartoon;if(a.y=App.RandomUtils.limitInteger(100,110),this.addChild(a),2==t)a.x=App.RandomUtils.limitInteger(App.GameWidth-145,App.GameWidth-125),a.setSouce(e,!0,1);else if(a.setSouce(e,!1,1),a.x=App.RandomUtils.limitInteger(125,145),DataCenter.instance.room.IsAI){var r=App.RandomUtils.limitInteger(1,5);r%2!=0&&App.TimerManager.doTimer(1e3*r,1,this.AddAIexpress,this)}else{var o=GameTwiceJoyModel.SEND_EXPRESS+"|"+e;App.MessageCenter.dispatch(EventMessage.SendGameEventC2S,o)}1==t?(a.img_1.scaleX=-1,a.onPlay(1)):a.onPlay(2)},t.prototype.AddAIexpress=function(){var e=App.RandomUtils.limitInteger(1,6),t="Express_five"+e+"_png";this.addQiPaoCartoon(t,2)},t.prototype.onSendExpressMessage=function(e){var t=egret.getTimer();if(t-DataCenter.instance.SendExpressTime>500){DataCenter.instance.SendExpressTime=t;var a="Express_five"+e.target.name+"_png";this.addQiPaoCartoon(a,1)}},t.prototype.goBackBtnHandler=function(){this.popup("GameSureLeave")},t.prototype.sendResult=function(e){App.MessageCenter.removeListener(EventMessage.ReceiveGameEventS2C,this.onGameEvent,this),this.clearData(),App.MessageCenter.dispatch(EventMessage.SendGameResultC2S,e)},t.GAME_WIDTH=640,t.GAME_HEIGHT=1136,t.avatarMoveDistance=206,t.aiConf={},t}(StateEui);__reflect(GameTwiceJoyMainView.prototype,"GameTwiceJoyMainView");var GameTwiceJoyModel=function(){function e(){this.twiceMapData=[],this.myScore=0,this.otherScore=0,this.myScore=0,this.otherScore=0}return e.prototype.mapInit=function(){this.twiceMapData.splice(0),this.twiceMapData=[];for(var t=[],a=[1,5,2,6,3,7,4,8],r=0;8>r;r++){var o=Math.floor(e.random()*a.length);t.push(a[o]),t.push(a[o]),a.splice(o,1)}for(var i=[1,5,2,6,3,7,4,8],s=0;4>s;s++){var o=Math.floor(e.random()*i.length);t.push(i[o]),t.push(i[o]),i.splice(o,1)}for(var c=0;24>c;c++){var o=Math.floor(e.random()*t.length);this.twiceMapData.push(t[o]),t.splice(o,1)}},e.CARD_MATCH_SUCCESS="CARD_MATCH_SUCCESS",e.SEND_EXPRESS="SEND_EXPRESS",e.resultScore=12,e}();__reflect(GameTwiceJoyModel.prototype,"GameTwiceJoyModel");